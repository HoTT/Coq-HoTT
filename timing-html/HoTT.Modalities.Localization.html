<html>
<head>
<title>Localization.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for Localization.v</h1>

<div class="code" title="File: Localization.v
Line: 1
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>(** * Localization *)

</pre>
</div>
<div class="code" title="File: Localization.v
Line: 2
Time: 0.038s">
<div class="time" style="width: 32.203389830508%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 2
Time: 0.029s">
<div class="time" style="width: 24.576271186441%"></div>
<pre>
Require Import Extensions.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 3
Time: 0.009s">
<div class="time" style="width: 7.6271186440678%"></div>
<pre>
Require Import ReflectiveSubuniverse Accessible.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 4
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope nat_scope.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Suppose given a family of maps [f : forall (i:I), S i -&gt; T i].  A type [X] is said to be [f]-local if for all [i:I], the map [(T i -&gt; X) -&gt; (S i -&gt; X)] given by precomposition with [f i] is an equivalence.  Our goal is to show that the [f]-local types form a reflective subuniverse, with a reflector constructed by localization.  That is, morally we want to say

&lt;&lt;
Inductive Localize f (X : Type) : Type :=
| loc : X -&gt; Localize X
| islocal_localize : forall i, IsEquiv (fun (g : T i -&gt; X) =&gt; g o f i).
&gt;&gt;

This is not a valid HIT by the usual rules, but if we expand out the definition of [IsEquiv] and apply [path_sigma] and [path_forall], then it becomes one.  We get a simpler definition (no 2-path constructors) if we do this with [BiInv] rather than [IsEquiv]:

&lt;&lt;
Inductive Localize f (X : Type) : Type :=
| loc : X -&gt; Localize X
| lsect : forall i (g : S i -&gt; X), T i -&gt; X
| lissect : forall i (g : S i -&gt; X) (s : S i), lsect i g (f i s) = g s
| lretr : forall i (g : S i -&gt; X), T i -&gt; X
| lisretr : forall i (h : T i -&gt; X) (t : T i), lretr i (h o f i) t = h t.
&gt;&gt;

This definition works, and from it one can prove that the [f]-local types form a reflective subuniverse.  However, the proof inextricably involves [Funext].  We can avoid [Funext] in the same way that we did in the definition of a [ReflectiveSubuniverse], by using pointwise path-split precomposition equivalences.  Observe that the assertion [ExtendableAlong n f C] consists entirely of points, paths, and higher paths in [C].  Therefore, for any [n] we might choose, we can define [Localize f X] as a HIT to universally force [ExtendableAlong n (f i) (fun _ =&gt; Localize f X)] to hold for all [i].  For instance, when [n] is 2 (the smallest value which will ensure that [Localize f X] is actually [f]-local), we get

&lt;&lt;
Inductive Localize f (X : Type) : Type :=
| loc : X -&gt; Localize X
| lrec : forall i (g : S i -&gt; X), T i -&gt; X
| lrec_beta : forall i (g : S i -&gt; X) (s : T i), lrec i g (f i s) = g s
| lindpaths : forall i (h k : T i -&gt; X) (p : h o f i == k o f i) (t : T i), h t = k t
| lindpaths_beta : forall i (h k : T i -&gt; X) (p : h o f i == k o f i) (s : S i),
                     lindpaths i h k p (f i s) = p s.
&gt;&gt;

However, just as for [ReflectiveSubuniverse], in order to completely avoid [Funext] we need the [oo]-version of path-splitness.  Written out as above, this would involve infinitely many constructors (but it would not otherwise be problematic, so for instance it can be constructed semantically in model categories).  We can't actually write out infinitely many constructors in Coq, of course, but since we have a finite definition of [ooExtendableAlong], we can just assert directly that [ooExtendableAlong (f i) (fun _ =&gt; Localize f X)] holds for all [i].

Then, however, we have to express the hypotheses of the induction principle.  We know what these should be for each path-constructor and higher path-constructor, so all we need is a way to package up those infinitely many hypotheses into a single one, analogously to [ooExtendableAlong].  Thus, we begin this file by defining a "dependent" version of [ooExtendableAlong], and of course we start this with a version for finite [n].  *)

(** ** Dependent extendability *)

</pre>
</div>
<div class="code" title="File: Localization.v
Line: 45
Time: 0.005s">
<div class="time" style="width: 4.2372881355932%"></div>
<pre>Fixpoint ExtendableAlong_Over@{a b c d m | a &lt;= m, b &lt;= m, c &lt;= m, d &lt;= m}
         (n : nat) {A : Type@{a}} {B : Type@{b}} (f : A -&gt; B)
         (C : B -&gt; Type@{c})
         (D : forall b, C b -&gt; Type@{d})
         (ext : ExtendableAlong@{a b c m} n f C)
: Type@{m}
  := match n return ExtendableAlong@{a b c m} n f C -&gt; Type@{m} with
       | 0 =&gt; fun _ =&gt; Unit
       | S n =&gt; fun ext' =&gt;
                (forall (g : forall a, C (f a)) (g' : forall a, D (f a) (g a)),
                  sig@{m m}     (** Control universe parameters *)
                  (fun (rec : forall b, D b ((fst ext' g).1 b)) =&gt;
                         forall a, (fst ext' g).2 a # rec (f a) = g' a )) *
                forall (h k : forall b, C b)
                       (h' : forall b, D b (h b)) (k' : forall b, D b (k b)),
                  ExtendableAlong_Over n f (fun b =&gt; h b = k b)
                    (fun b c =&gt; c # h' b = k' b) (snd ext' h k)
     end ext.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 62
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Like [ExtendableAlong], these can be postcomposed with known equivalences. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 64
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Definition extendable_over_postcompose' (n : nat)
           {A B : Type} (C : B -&gt; Type) (f : A -&gt; B)
           (ext : ExtendableAlong n f C)
           (D E : forall b, C b -&gt; Type)
           (g : forall b c, D b c &lt;~&gt; E b c)
: ExtendableAlong_Over n f C D ext
  -&gt; ExtendableAlong_Over n f C E ext.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 70
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 71
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
  revert C ext D E g; simple_induction n n IHn; intros C ext D E g; simpl.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 72
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1: exact idmap.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 73
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros ext'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 74
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  split.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 75
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 76
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 76
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
    exists (fun b =&gt; g b ((fst ext h).1 b)
                     ((fst ext' h (fun a =&gt; (g _ _)^-1 (k a))).1 b)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 78
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 79
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine ((ap_transport ((fst ext h).2 a) (g (f a)) _)^ @ _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply moveR_equiv_M.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact ((fst ext' h (fun a =&gt; (g _ _)^-1 (k a))).2 a).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 82
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 83
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros p q p' q'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 83
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>
    refine (IHn (fun b =&gt; p b = q b) _
                (fun b =&gt; fun c =&gt; transport (D b) c ((g b (p b))^-1 (p' b))
                                   = ((g b (q b))^-1 (q' b)))
                _ _
                (snd ext' p q (fun b =&gt; (g b (p b))^-1 (p' b))
                              (fun b =&gt; (g b (q b))^-1 (q' b)))).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 89
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b c.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 90
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (_ oE equiv_moveR_equiv_M _ _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply equiv_concat_l.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 92
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (_ @ (ap_transport c (g b) _)^).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ap, symmetry, eisretr.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 94
Time: 0.005s">
<div class="time" style="width: 4.2372881355932%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 95
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>

Definition extendable_over_postcompose (n : nat)
           {A B : Type} (C : B -&gt; Type) (f : A -&gt; B)
           (ext : ExtendableAlong n f C)
           (D E : forall b, C b -&gt; Type)
           (g : forall b c, D b c -&gt; E b c)
           `{forall b c, IsEquiv (g b c)}
: ExtendableAlong_Over n f C D ext
  -&gt; ExtendableAlong_Over n f C E ext
:= extendable_over_postcompose' n C f ext D E
     (fun b c =&gt; Build_Equiv _ _ (g b c) _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** And if the dependency is trivial, we obtain them from an ordinary [ExtendableAlong]. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 108
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition extendable_over_const
           (n : nat) {A B : Type} (C : B -&gt; Type) (f : A -&gt; B)
           (ext : ExtendableAlong n f C) (D : B -&gt; Type)
: ExtendableAlong n f D
  -&gt; ExtendableAlong_Over n f C (fun b _ =&gt; D b) ext.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  revert C ext D.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 114
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  simple_induction n n IHn; intros C ext D ext'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1:exact tt.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  split.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 117
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g g'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists ((fst ext' g').1).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 119
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
    exact (fun a =&gt; transport_const ((fst ext g).2 a) _
                                    @ (fst ext' g').2 a).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 122
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k h' k'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 122
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
    refine (extendable_over_postcompose' _ _ _ _ _ _ _
              (IHn (fun b =&gt; h b = k b) (snd ext h k)
                   (fun b =&gt; h' b = k' b) (snd ext' h' k'))).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 125
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (fun b c =&gt; equiv_concat_l (transport_const c (h' b)) (k' b)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 126
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This lemma will be used in stating the computation rule for localization. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 129
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Fixpoint apD_extendable_eq (n : nat) {A B : Type} (C : B -&gt; Type) (f : A -&gt; B)
         (ext : ExtendableAlong n f C) (D : forall b, C b -&gt; Type)
         (g : forall b c, D b c)
         (ext' : ExtendableAlong_Over n f C D ext)
         {struct n}
: Type.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 134
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 135
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  destruct n.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 136
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 137
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact Unit.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 137
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply prod.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Localization.v
Line: 139
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre> exact (forall (h : forall a, C (f a)) (b : B),
               g b ((fst ext h).1 b) = (fst ext' h (fun a =&gt; g (f a) (h a))).1 b).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Localization.v
Line: 141
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre> exact (forall h k, apD_extendable_eq
                           n A B (fun b =&gt; h b = k b) f (snd ext h k)
                           (fun b c =&gt; c # g b (h b) = g b (k b))
                           (fun b c =&gt; apD (g b) c)
                           (snd ext' h k _ _)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 145
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here's the [oo]-version. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 148
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Definition ooExtendableAlong_Over@{a b c d m | a &lt;= m, b &lt;= m, c &lt;= m, d &lt;= m}
         {A : Type@{a}} {B : Type@{b}} (f : A -&gt; B) (C : B -&gt; Type@{c})
         (D : forall b, C b -&gt; Type@{d}) (ext : ooExtendableAlong f C)
  := forall n, ExtendableAlong_Over@{a b c d m} n f C D (ext n).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 151
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The [oo]-version for trivial dependency. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 153
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Definition ooextendable_over_const
           {A B : Type} (C : B -&gt; Type) (f : A -&gt; B)
           (ext : ooExtendableAlong f C) (D : B -&gt; Type)
: ooExtendableAlong f D
  -&gt; ooExtendableAlong_Over f C (fun b _ =&gt; D b) ext
:= fun ext' n =&gt; extendable_over_const n C f (ext n) D (ext' n).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** A crucial fact: the [oo]-version is inherited by types of homotopies. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 160
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Definition ooextendable_over_homotopy
           {A B : Type} (C : B -&gt; Type) (f : A -&gt; B)
           (ext : ooExtendableAlong f C)
           (D : forall b, C b -&gt; Type)
           (r s : forall b c, D b c)
: ooExtendableAlong_Over f C D ext
  -&gt; ooExtendableAlong_Over f C (fun b c =&gt; r b c = s b c) ext.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 166
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 167
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros ext' n.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 168
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  revert C ext D r s ext'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 169
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  simple_induction n n IHn; intros C ext D r s ext'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 170
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1:exact tt.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 171
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  split.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g g'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simple refine (_;_); simpl.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 174
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Localization.v
Line: 175
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 175
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>
      refine (_ @ (fst (snd (ext' 2) _ _
                            (fun b' =&gt; r b' ((fst (ext n.+1) g).1 b'))
                            (fun b' =&gt; s b' ((fst (ext n.+1) g).1 b')))
                       (fun _ =&gt; 1) _).1 b).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 179
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Localization.v
Line: 180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (transport2 (D b) (p := 1) _ _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 180
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>
        refine ((fst (snd (snd (ext 3) _ _) (fun b' =&gt; 1)
                          ((fst (snd (ext 2) _ _) (fun a : A =&gt; 1)).1)
                ) _).1 b); intros a.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 183
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
        symmetry; exact ((fst (snd (ext 2) _ _) (fun a' =&gt; 1)).2 a).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 184
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Localization.v
Line: 185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a; simpl.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 185
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>
        refine (_ @
          ap (transport (D (f a)) ((fst (ext n.+1) g).2 a)^) (g' a)
          @ _);
        [ symmetry; by apply apD
        | by apply apD ].</pre>
</div>
<div class="code" title="File: Localization.v
Line: 190
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    +</pre>
</div>
<div class="code" title="File: Localization.v
Line: 191
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre> intros a; simpl.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 191
Time: 0.004s">
<div class="time" style="width: 3.3898305084746%"></div>
<pre>
      set (h := (fst (ext n.+1) g).1).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 192
Time: 0.007s">
<div class="time" style="width: 5.9322033898305%"></div>
<pre>
      match goal with
          |- context[   (fst (snd (ext' 2) _ _ ?k1 ?k2) (fun _ =&gt; 1) ?l).1 ]
          =&gt; pose (p := (fst (snd (ext' 2) _ _  k1  k2) (fun _ =&gt; 1) l).2 a);
            simpl in p
      end.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 197
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
      rewrite transport_paths_Fl in p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 198
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
      apply moveL_Mp in p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 199
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>
      refine (ap (transport _ _) (1 @@ p) @ _); clear p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 200
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
      unfold transport2; rewrite concat_p_pp.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 201
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
      match goal with
          |- transport ?P ?p ((ap ?f ?q @ ap ?f ?r) @ ?s) = ?t
          =&gt; refine (ap (transport P p) ((ap_pp f q r)^ @@ (idpath s)) @ _)
      end.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 205
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
      pose (p := (fst (snd (snd (ext 3) h h) (fun b' : B =&gt; 1)
                           ((fst (snd (ext 2) h h) (fun a0 : A =&gt; 1)).1))
                      (fun a' : A =&gt; ((fst (snd (ext 2) h h)
                                           (fun a' : A =&gt; 1)).2 a')^)).2 a);
        simpl in p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 210
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
      refine (ap (transport _ _) (ap (ap _) (p @@ 1) @@ 1) @ _); clear p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 211
Time: 0.003s">
<div class="time" style="width: 2.5423728813559%"></div>
<pre>
      rewrite concat_Vp; simpl; rewrite concat_1p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 212
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
      refine (transport_paths_FlFr_D _ _ @ _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 213
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Open Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 214
Time: 0.015s">
<div class="time" style="width: 12.71186440678%"></div>
<pre>
      rewrite !ap_pp, !concat_p_pp, ap_transport_pV.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Even though https://github.com/coq/coq/issues/4533 is closed, this workaround is still needed. Without the Opaque setting, the [rewrite] unfolds the first [transport_pV] in the goal, and the first [moveR_Vp] below fails. *)
     </pre>
</div>
<div class="code" title="File: Localization.v
Line: 217
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Opaque transport_pV.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 217
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* work around bug 4533 *)
     </pre>
</div>
<div class="code" title="File: Localization.v
Line: 218
Time: 0.007s">
<div class="time" style="width: 5.9322033898305%"></div>
<pre>rewrite !concat_p_pp.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 218
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Local Transparent transport_pV.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* work around bug 4533 *)
     </pre>
</div>
<div class="code" title="File: Localization.v
Line: 220
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>refine ((((_  @@ 1) @ concat_1p _) @@ 1 @@ 1 @@ 1) @ _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Localization.v
Line: 221
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre> rewrite ap_V, concat_pp_p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 221
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
        do 2 apply moveR_Vp.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 222
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
        rewrite concat_p1.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 223
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
        symmetry; apply transport_pV_ap.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 224
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      *</pre>
</div>
<div class="code" title="File: Localization.v
Line: 225
Time: 0.004s">
<div class="time" style="width: 3.3898305084746%"></div>
<pre> rewrite !concat_pp_p.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 225
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine ((1 @@ _) @ (concat_p1 _)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 226
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
        apply moveR_Vp; rewrite concat_p1.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 227
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply transport_pV_ap.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k h' k'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 230
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
    refine (extendable_over_postcompose' _ _ _ _ _ _
             (fun b c =&gt; equiv_cancelL (apD (r b) c) _ _) _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 232
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
    exact (IHn _ _ _ _ _
                (fun n =&gt; snd (ext' n.+1) h k
                              (fun b =&gt; r b (h b)) (fun b =&gt; s b (k b)))).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 235
Time: 0.118s">
<div class="time" style="width: 100%"></div>
<pre>
Qed.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 236
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Local types *)

</pre>
</div>
<div class="code" title="File: Localization.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Import IsLocal_Internal.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 239
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition islocal_equiv_islocal (f : LocalGenerators@{a})
           (X : Type@{i}) {Y : Type@{j}}
           (Xloc : IsLocal@{i i' a} f X)
           (g : X -&gt; Y) `{IsEquiv@{i j} _ _ g}
: IsLocal@{j j' a} f Y.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 245
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 246
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros i.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 247
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** We have to fiddle with the max universes to get this to work, since [ooextendable_postcompose] requires the max universe in both cases to be the same, whereas we don't want to assume that the hypothesis and conclusion are related in any way. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 249
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>apply lift_ooextendablealong@{a a a a a a j j j k j'}.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 249
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
  refine (ooextendable_postcompose@{a a i j k k k k k k}
            _ _ (f i) (fun _ =&gt; g) _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 251
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply lift_ooextendablealong@{a a a a a a i i i i' k}.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply Xloc.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Localization as a HIT *)

</pre>
</div>
<div class="code" title="File: Localization.v
Line: 257
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Module Export LocalizationHIT.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 257
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Cumulative Private Inductive Localize (f : LocalGenerators@{a}) (X : Type@{i})
  : Type@{max(a,i)} :=
  | loc : X -&gt; Localize f X.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 261
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Arguments loc {f X} x.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Note that the following axiom actually contains a point-constructor.  We could separate out that point-constructor and make it an actual argument of the private inductive type, thereby getting a judgmental computation rule for it.  However, since locality is an hprop, there seems little point to this. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Axiom islocal_localize
  : forall (f : LocalGenerators@{a}) (X : Type@{i}),
      IsLocal@{i k a} f (Localize f X).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 268
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>

  Definition Localize_ind
           (f : LocalGenerators@{a}) (X : Type@{i})
           (P : Localize f X -&gt; Type@{j})
           (loc' : forall x, P (loc x))
           (islocal' : forall i, ooExtendableAlong_Over@{a a i j k}
                                   (f i) (fun _ =&gt; Localize@{a i} f X)
                                   (fun _ =&gt; P)
                                   (islocal_localize@{a i k} f X i))
           (z : Localize f X)
  : P z
    := match z with
         | loc x =&gt; fun _ =&gt; loc' x
       end islocal'.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 282
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We now state the computation rule for [islocal_localize].  Since locality is an hprop, we never actually have any use for it, but the fact that we can state it is a reassuring check that we have defined a meaningful HIT. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 285
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Axiom Localize_ind_islocal_localize_beta :
    forall (f : LocalGenerators) (X : Type)
           (P : Localize f X -&gt; Type)
           (loc' : forall x, P (loc x))
           (islocal' : forall i, ooExtendableAlong_Over
                                   (f i) (fun _ =&gt; Localize f X)
                                   (fun _ =&gt; P)
                                   (islocal_localize f X i))
           i n,
      apD_extendable_eq n (fun _ =&gt; Localize f X) (f i)
                        (islocal_localize f X i n) (fun _ =&gt; P)
                        (fun _ =&gt; Localize_ind f X P loc' islocal')
                        (islocal' i n).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 297
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End LocalizationHIT.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Now we prove that localization is a reflective subuniverse. *)

</pre>
</div>
<div class="code" title="File: Localization.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Localization.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Context (f : LocalGenerators).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 304
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The induction principle is an equivalence. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition ext_localize_ind (X : Type)
      (P : Localize f X -&gt; Type)
      (Ploc : forall i, ooExtendableAlong_Over
                          (f i) (fun _ =&gt; Localize f X)
                          (fun _ =&gt; P) (islocal_localize f X i))
  : ooExtendableAlong loc P.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 312
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 313
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros n; generalize dependent P.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 314
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simple_induction n n IHn; intros P Ploc.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    1:exact tt.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 316
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    split.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 317
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exists (Localize_ind f X P g Ploc).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 319
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros x; reflexivity.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 320
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 321
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k; apply IHn; intros i m.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 321
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ooextendable_over_homotopy.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 322
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (Ploc i).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 324
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Localization.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition Loc@{a i} (f : LocalGenerators@{a}) : ReflectiveSubuniverse@{i}.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 329
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  snrefine (Build_ReflectiveSubuniverse
                                 (Build_Subuniverse (IsLocal f) _ _)
                                 (fun A =&gt; Build_PreReflects _ A (Localize f A) _ (@loc f A))
                                 (fun A =&gt; Build_Reflects _ _ _ _)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 333
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 334
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (** Typeclass inference can find this, but we give it explicitly to prevent extra universes from cropping up. *)
   </pre>
</div>
<div class="code" title="File: Localization.v
Line: 335
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>intros ? T; unfold IsLocal.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 335
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    nrefine (istrunc_forall@{a i i}); try assumption.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 336
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros i.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 337
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ishprop_ooextendable@{a a i i i
                                i i i i i
                                i i i i i i}.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 340
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 341
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply islocal_equiv_islocal.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 341
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 342
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply islocal_localize.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 342
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> cbn.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros Q Q_inO.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ext_localize_ind; intros ?.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 344
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ooextendable_over_const.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply Q_inO.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 346
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 347
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here is the "real" definition of the notation [IsLocal].  Defining it this way allows it to inherit typeclass inference from [In], unlike (for instance) the slightly annoying case of [IsTrunc n] versus [In (Tr n)]. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 349
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Notation IsLocal f := (In (Loc f)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 349
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section LocalTypes.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 351
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (f : LocalGenerators).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A remark on universes: recall that [ooExtendableAlong] takes four universe parameters, three for the sizes of the types involved and one for the max of all of them.  In the definition of [IsLocal f X] we set that max universe to be the same as the size of [X], so that [In (Loc f) X] would lie in the same universes as [X], which is necessary for our definition of a reflective subuniverse.  However, in practice we may need this extendability property with the max universe being larger, to avoid coalescing universes undesiredly.  Thus, in making it available by the following name, we also insert a [lift] to generalize the max universe. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 355
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition ooextendable_islocal {X : Type@{i}} {Xloc : IsLocal f X} i
  : ooExtendableAlong@{a a i k} (f i) (fun _ =&gt; X)
    := (lift_ooextendablealong _ _ (Xloc i)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  #[export] Instance islocal_loc (X : Type) : IsLocal f (Localize f X)
    := islocal_localize f X.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 360
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>

  #[export] Instance isequiv_precomp_islocal `{Funext}
         {X : Type} `{IsLocal f X} i
  : IsEquiv (fun g =&gt; g o f i)
  := isequiv_ooextendable (fun _ =&gt; X) (f i) (ooextendable_islocal i).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 365
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The non-dependent eliminator *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 368
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition Localize_rec {X Z : Type} `{IsLocal f Z} (g : X -&gt; Z)
  : Localize f X -&gt; Z.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 369
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 370
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (Localize_ind f X (fun _ =&gt; Z) g _); intros i.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 371
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ooextendable_over_const.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 372
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply ooextendable_islocal.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 373
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 374
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>

  Definition local_rec {X} `{IsLocal f X} {i} (g : lgen_domain f i -&gt; X)
  : lgen_codomain f i -&gt; X
  := (fst (ooextendable_islocal i 1%nat) g).1.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 378
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>

  Definition local_rec_beta {X} `{IsLocal f X} {i} (g : lgen_domain f i -&gt; X) s
  : local_rec g (f i s) = g s
    := (fst (ooextendable_islocal i 1%nat) g).2 s.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 382
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>

  Definition local_indpaths {X} `{IsLocal f X} {i} {h k : lgen_codomain f i -&gt; X}
             (p : h o f i == k o f i)
  : h == k
    := (fst (snd (ooextendable_islocal i 2) h k) p).1.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 387
Time: 0.002s">
<div class="time" style="width: 1.6949152542373%"></div>
<pre>

  Definition local_indpaths_beta {X} `{IsLocal f X} {i} (h k : lgen_codomain f i -&gt; X)
             (p : h o f i == k o f i) s
  : local_indpaths p (f i s) = p s
    := (fst (snd (ooextendable_islocal i 2) h k) p).2 s.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 392
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End LocalTypes.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 394
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments local_rec : simpl never.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 396
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments local_rec_beta : simpl never.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 397
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments local_indpaths : simpl never.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 398
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments local_indpaths_beta : simpl never.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 399
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Localization and accessibility *)

(** Localization subuniverses are accessible, essentially by definition.  Without the universe annotations, [a] and [i] get collapsed. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 403
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance accrsu_loc@{a i} (f : LocalGenerators@{a}) : IsAccRSU@{a i} (Loc@{a i} f).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 403
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 404
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unshelve econstructor.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 405
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 406
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact f.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 406
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 407
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros; split; exact idmap.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 407
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 408
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Conversely, if a subuniverse is accessible, then the corresponding localization subuniverse is equivalent to it, and moreover exists at every universe level and satisfies its computation rules judgmentally.  This is called [lift_accrsu] but in fact it works equally well to *lower* the universe level, as long as both levels are no smaller than the size [a] of the generators. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 410
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition lift_accrsu@{a i j} (O : Subuniverse@{i}) `{IsAccRSU@{a i} O}
  : ReflectiveSubuniverse@{j}
  := Loc@{a j} (acc_lgen O).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 412
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The lifted universe agrees with the original one, on any universe contained in both [i] and [j] *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 414
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance O_eq_lift_accrsu@{a i j k} (O : Subuniverse@{i}) `{IsAccRSU@{a i} O}
  : O_eq@{i j k} O (lift_accrsu@{a i j} O).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 416
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Anyone stepping through this proof should do [Set Printing Universes]. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>split; intros A A_inO.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> 
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 419
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros i.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 419
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (e := fst (inO_iff_islocal O A) A_inO i).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 420
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply (lift_ooextendablealong@{a a a a a a i j k i j} (acc_lgen O i) (fun _ =&gt; A)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 421
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact e.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 422
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 423
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply (inO_iff_islocal O).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 423
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros i.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 424
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (e := A_inO i).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 425
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply (lift_ooextendablealong@{a a a a a a j i k j i} (acc_lgen O i) (fun _ =&gt; A)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact e.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 427
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition O_leq_lift_accrsu@{a i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{IsAccRSU@{a i1} O1}
           `{O_leq@{i1 i2 i2} O1 O2}
  : O_leq@{i2 i2 i2} (lift_accrsu@{a i1 i2} O1) O2.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 433
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 434
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros B B_inO1.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (inO_leq@{i1 i2 i2} O1 O2).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 436
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (snd (inO_iff_islocal O1 B)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 437
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros i.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> specialize (B_inO1 i).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (lift_ooextendablealong@{a a a a a a i2 i1 i2 i2 i1} (acc_lgen O1 i) (fun _ =&gt; B)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 439
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exact B_inO1.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 440
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 441
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Similarly, because localization is a HIT that has an elimination rule into types in *all* universes, for accessible reflective subuniverses we can show that containment implies connectedness properties with the universe containments in the other order. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 443
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_O_leq'@{a i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{IsAccRSU@{a i1} O1}
           (** Compared to [O_leq@{i1 i2 i1}] and [A : Type@{i1}] in [isconnected_O_leq], these two lines are what make [i2 &lt;= i1] instead of vice versa. *)
           `{O_leq@{i1 i2 i2} O1 O2} (A : Type@{i2}) 
           `{IsConnected O2 A}
  : IsConnected O1 A.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 448
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 449
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Anyone stepping through this proof should do [Set Printing Universes]. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 451
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>srefine (isconnected_O_leq O1 (lift_accrsu@{a i1 i1} O1) A).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 451
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1-2:exact _.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 452
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  change (Contr@{i1} (Localize@{a i2} (acc_lgen@{a i1} O1) A)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** At this point you should also do [Unset Printing Notations] to see the universe annotation on [IsTrunc] change. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 455
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>refine (contr_equiv'@{i2 i1} _ 1%equiv).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 455
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  change (IsConnected@{i2} (lift_accrsu@{a i1 i2} O1) A).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 456
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  srapply (isconnected_O_leq _ O2).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 457
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  rapply O_leq_lift_accrsu.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 458
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 459
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** And similarly for connected maps. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 461
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition conn_map_O_leq'@{a i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{IsAccRSU@{a i1} O1}
           `{O_leq@{i1 i2 i2} O1 O2} {A B : Type@{i2}}
           (f : A -&gt; B) `{IsConnMap O2 A B f}
  : IsConnMap O1 f.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 465
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 466
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** Anyone stepping through this proof should do [Set Printing Universes]. *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>intros b.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (isconnected_equiv' O1 (hfiber@{i2 i2} f b)).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 469
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> srapply equiv_adjointify.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    1-2:intros [u p]; exact (u;p).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    all:intros [u p]; reflexivity.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: Localization.v
Line: 473
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply (isconnected_O_leq' O1 O2).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 473
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isconnected_hfiber_conn_map.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 474
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 475
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The same is true for inverted maps, too. *)</pre>
</div>
<div class="code" title="File: Localization.v
Line: 477
Time: 0.001s">
<div class="time" style="width: 0.84745762711864%"></div>
<pre>Definition O_inverts_O_leq'@{a i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{IsAccRSU@{a i1} O1}
           `{O_leq@{i1 i2 i2} O1 O2} {A B : Type@{i2}}
           (f : A -&gt; B) `{O_inverts O2 f}
  : O_inverts O1 f.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 481
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 482
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (oleq := O_leq_lift_accrsu O1 O2).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 483
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  assert (e := O_inverts_O_leq (lift_accrsu@{a i1 i2} O1) O2 f); clear oleq.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 484
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  napply (O_inverts_O_leq O1 (lift_accrsu@{a i1 i1} O1) f).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 485
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1:exact _.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 486
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** It looks like we can say [exact e], but that would collapse the universes [i1] and [i2].  You can check with [Set Printing Universes. Unset Printing Notations.] that [e] and the goal have different universes.  So instead we do this: *)
 </pre>
</div>
<div class="code" title="File: Localization.v
Line: 488
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>refine (@isequiv_homotopic _ _ _ _ e _).</pre>
</div>
<div class="code" title="File: Localization.v
Line: 488
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply O_indpaths; intros x; reflexivity.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 489
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: Localization.v
Line: 491
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

