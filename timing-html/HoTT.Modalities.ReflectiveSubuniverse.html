<html>
<head>
<title>ReflectiveSubuniverse.v</title>
<style>
.time {
  background-color: #ffaaaa;
  height: 100%;
  z-index: -1;
  position: absolute;
}
.code {
  z-index: 0;
  position: relative;
  border-style: solid;
  border-color: transparent;
  border-width: 1px;
}
.code:hover {
  border-style: solid;
  border-color: black;
  border-width: 1px;
}
pre {
  margin: 1px;
}
</style>
</head>
<body>
<h1>Timings for ReflectiveSubuniverse.v</h1>

<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1
Time: 0.038s">
<div class="time" style="width: 50%"></div>
<pre>Require Import HoTT.Basics HoTT.Types.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1
Time: 0.027s">
<div class="time" style="width: 35.526315789474%"></div>
<pre>
Require Import Equiv.BiInv Extensions HProp HFiber NullHomotopy Limits.Pullback.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import Homotopy.IdentitySystems.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 3
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Require Import Colimits.Pushout.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 4
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Local Open Scope nat_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 6
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Local Open Scope path_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 7
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** * Reflective Subuniverses *)

(** ** References  *)

(** Reflective subuniverses (and modalities) are studied in the following papers, which we will refer to below by their abbreviations:

- The Book: The Homotopy Type Theory Book, chapter 7.  Bare references to "Theorem 7.x.x" are always to the Book.
- RSS: Rijke, Spitters, and Shulman, "Modalities in homotopy type theory", https://arxiv.org/abs/1706.07526.
- CORS: Christensen, Opie, Rijke, and Scoccola, "Localization in Homotopy Type Theory", https://arxiv.org/abs/1807.04155.
*)

(** ** Definitions *)

(** *** Subuniverses *)

</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 23
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Record Subuniverse@{i} :=
{
  In_internal : Type@{i} -&gt; Type@{i} ;
  hprop_inO_internal : Funext -&gt; forall (T : Type@{i}),
      IsHProp (In_internal T) ;
  inO_equiv_inO_internal : forall (T U : Type@{i}) (T_inO : In_internal T)
                                  (f : T -&gt; U) {feq : IsEquiv f},
      In_internal U ;
}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 31
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Work around Coq bug that fields of records can't be typeclasses. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 33
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Class In (O : Subuniverse) (T : Type) := in_internal : In_internal O T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 33
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Being in the subuniverse is a mere predicate (by hypothesis).  We include funext in the hypotheses of [hprop_inO] so that it doesn't have to be assumed in all definitions of (reflective) subuniverses, since in most examples it is required for this and this only.  Here we redefine it using the replaced [In]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 35
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance hprop_inO `{Funext} (O : Subuniverse) (T : Type)
  : IsHProp (In O T)
  := @hprop_inO_internal _ _ T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 37
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We assumed repleteness of the subuniverse in the definition.  Of course, with univalence this would be automatic, but we include it as a hypothesis since most of the theory of reflective subuniverses and modalities doesn't need univalence, and most or all examples can be shown to be replete without using univalence.  Here we redefine it using the replaced [In]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 39
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition inO_equiv_inO {O : Subuniverse} (T : Type) {U : Type}
           `{T_inO : In O T} (f : T -&gt; U) `{IsEquiv T U f}
  : In O U
  := @inO_equiv_inO_internal O T U T_inO f _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 42
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition inO_equiv_inO' {O : Subuniverse}
           (T : Type) {U : Type} `{In O T} (f : T &lt;~&gt; U)
  : In O U
  := inO_equiv_inO T f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 47
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition iff_inO_equiv (O : Subuniverse)
           {T : Type} {U : Type} (f : T &lt;~&gt; U)
  : In O T &lt;-&gt; In O U
  := (fun H =&gt; inO_equiv_inO' _ f, fun H =&gt; inO_equiv_inO' _ f^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 52
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

Definition equiv_inO_equiv `{Funext} (O : Subuniverse)
           {T : Type} {U : Type} (f : T &lt;~&gt; U)
  : In O T &lt;~&gt; In O U
  := equiv_iff_hprop_uncurried (iff_inO_equiv _ f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 57
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The universe of types in the subuniverse *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 59
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition Type_@{i j} (O : Subuniverse@{i}) : Type@{j}
  := @sig@{j i} Type@{i} (fun (T : Type@{i}) =&gt; In O T).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 60
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Coercion TypeO_pr1 O (T : Type_ O) := @pr1 Type (In O) T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 62
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** The second component of [TypeO] is unique.  *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 64
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition path_TypeO@{i j} {fs : Funext} O (T T' : Type_@{i j} O) (p : T.1 = T'.1)
  : T = T'
  := path_sigma_hprop@{j i j} T T' p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 66
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

Definition equiv_path_TypeO@{i j} {fs : Funext} O (T T' : Type_@{i j} O)
  : (paths@{j} T.1 T'.1) &lt;~&gt; (T = T')
  := equiv_path_sigma_hprop@{j i j} T T'.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 70
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Types in [TypeO] are always in [O]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 72
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance inO_TypeO {O : Subuniverse} (A : Type_ O) : In O A
  := A.2.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 73
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Properties of Subuniverses *)

(** A map is O-local if all its fibers are. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 77
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Class MapIn (O : Subuniverse) {A B : Type} (f : A -&gt; B)
  := inO_hfiber_ino_map :: forall (b:B), In O (hfiber f b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 78
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 80
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : Subuniverse).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 81
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being a local map is an hprop *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 84
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance ishprop_mapinO `{Funext} {A B : Type} (f : A -&gt; B)
  : IsHProp (MapIn O f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 85
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 86
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    exact istrunc_forall.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 87
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 88
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a local map is local. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 91
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition mapinO_homotopic {A B : Type} (f : A -&gt; B) {g : A -&gt; B}
             (p : f == g) `{MapIn O _ _ f}
  : MapIn O g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 93
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 94
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 95
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (inO_equiv_inO (hfiber f b)
                          (equiv_hfiber_homotopic f g p b)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 97
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 98
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The projection from a family of local types is local. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 101
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance mapinO_pr1 {A : Type} {B : A -&gt; Type}
         `{forall a, In O (B a)}
  : MapIn O (@pr1 A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 104
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 105
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    exact (inO_equiv_inO (B a) (hfiber_fibration a B)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 106
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A family of types is local if and only if the associated projection map is local. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Lemma iff_forall_inO_mapinO_pr1 {A : Type} (B : A -&gt; Type)
    : (forall a, In O (B a)) &lt;-&gt; MapIn O (@pr1 A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    split.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 114
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 114
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* Uses the instance mapinO_pr1 above. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>-</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 115
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rapply functor_forall; intros a x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 115
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      exact (inO_equiv_inO (hfiber pr1 a)
                           (hfiber_fibration a B)^-1%equiv).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 117
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Lemma equiv_forall_inO_mapinO_pr1 `{Funext} {A : Type} (B : A -&gt; Type)
    : (forall a, In O (B a)) &lt;~&gt; MapIn O (@pr1 A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 122
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    exact (equiv_iff_hprop_uncurried (iff_forall_inO_mapinO_pr1 B)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 123
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 124
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

End Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 126
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Reflections *)

(** A pre-reflection is a map to a type in the subuniverse. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 130
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Class PreReflects@{i} (O : Subuniverse@{i}) (T : Type@{i}) :=
{
  O_reflector : Type@{i} ;
  O_inO :: In O O_reflector ;
  to : T -&gt; O_reflector ;
}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 135
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments O_reflector O T {_}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 137
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments to O T {_}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 138
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_inO {O} T {_}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 139
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It is a reflection if it has the requisite universal property. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 141
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Class Reflects@{i} (O : Subuniverse@{i}) (T : Type@{i})
      `{PreReflects@{i} O T} :=
{
  extendable_to_O : forall {Q : Type@{i}} {Q_inO : In O Q},
      ooExtendableAlong (to O T) (fun _ =&gt; Q)
}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 146
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments extendable_to_O O {T _ _ Q Q_inO}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Here's a modified version that applies to types in possibly-smaller universes without collapsing those universes to [i]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition extendable_to_O'@{i j k | j &lt;= i, k &lt;= i} (O : Subuniverse@{i}) (T : Type@{j})
           `{Reflects O T} {Q : Type@{k}} {Q_inO : In O Q}
  : ooExtendableAlong (to O T) (fun _ =&gt; Q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 152
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 153
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply lift_ooextendablealong.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 154
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  rapply extendable_to_O.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 155
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 156
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** In particular, every type in the subuniverse automatically reflects into it. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition prereflects_in (O : Subuniverse) (T : Type) `{In O T} : PreReflects O T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unshelve econstructor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 160
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 161
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 161
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 163
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 163
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 164
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition reflects_in (O : Subuniverse) (T : Type) `{In O T} : @Reflects O T (prereflects_in O T).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 166
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 167
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  constructor; intros; rapply ooextendable_equiv.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 168
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 169
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** A reflective subuniverse is one for which every type reflects into it. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 171
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Record ReflectiveSubuniverse@{i} :=
{
  rsu_subuniv : Subuniverse@{i} ;
  rsu_prereflects :: forall (T : Type@{i}), PreReflects rsu_subuniv T ;
  rsu_reflects :: forall (T : Type@{i}), Reflects rsu_subuniv T ;
}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 176
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Coercion rsu_subuniv : ReflectiveSubuniverse &gt;-&gt; Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 178
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** We allow the name of a subuniverse or modality to be used as the name of its reflector.  This means that when defining a particular example, you should generally put the parametrizing family in a wrapper, so that you can notate the subuniverse as parameterized by, rather than identical to, its parameter.  See Modality.v, Truncations.v, and Localization.v for examples. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition rsu_reflector (O : ReflectiveSubuniverse) (T : Type) : Type
  := O_reflector O T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 181
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Coercion rsu_reflector : ReflectiveSubuniverse &gt;-&gt; Funclass.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** *** Recursion principles *)

(** We now extract the recursion principle and the restricted induction principles for paths. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ORecursion.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context {O : Subuniverse} {P Q : Type} {Q_inO : In O Q} `{Reflects O P}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 188
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition O_rec (f : P -&gt; Q)
    : O_reflector O P -&gt; Q
    := (fst (extendable_to_O O 1%nat) f).1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 192
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition O_rec_beta (f : P -&gt; Q) (x : P)
    : O_rec f (to O P x) = f x
    := (fst (extendable_to_O O 1%nat) f).2 x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 196
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

  Definition O_indpaths (g h : O_reflector O P -&gt; Q)
             (p : g o to O P == h o to O P)
    : g == h
    := (fst (snd (extendable_to_O O 2) g h) p).1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 201
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

  Definition O_indpaths_beta (g h : O_reflector O P -&gt; Q)
             (p : g o (to O P) == h o (to O P)) (x : P)
    : O_indpaths g h p (to O P x) = p x
    := (fst (snd (extendable_to_O O 2) g h) p).2 x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 206
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>

  Definition O_ind2paths {g h : O_reflector O P -&gt; Q} (p q : g == h)
             (r : p oD (to O P) == q oD (to O P))
    : p == q
    := (fst (snd (snd (extendable_to_O O 3) g h) p q) r).1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 211
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>

  Definition O_ind2paths_beta {g h : O_reflector O P -&gt; Q} (p q : g == h)
             (r : p oD (to O P) == q oD (to O P)) (x : P)
    : O_ind2paths p q r (to O P x) = r x
    := (fst (snd (snd (extendable_to_O O 3) g h) p q) r).2 x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 216
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Clearly we can continue indefinitely as needed. *)

</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>End ORecursion.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 219
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(* We never want to see [extendable_to_O].  The [!x] allows [cbn] to unfold these when passed a constructor, such as [tr x].  This, for example, means that [O_rec (O:=Tr n) f (tr x)] will compute to [f x] and [Trunc_functor n f (tr x)] will compute to [tr (f x)]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 221
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Arguments O_rec {O} {P Q}%_type_scope {Q_inO H H0} f%_function_scope !x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 221
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_rec_beta {O} {P Q}%_type_scope {Q_inO H H0} f%_function_scope !x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 222
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_indpaths {O} {P Q}%_type_scope {Q_inO H H0} (g h)%_function_scope p !x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 223
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_indpaths_beta {O} {P Q}%_type_scope {Q_inO H H0} (g h)%_function_scope p !x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 224
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_ind2paths {O} {P Q}%_type_scope {Q_inO H H0} {g h}%_function_scope p q r !x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 225
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Arguments O_ind2paths_beta {O} {P Q}%_type_scope {Q_inO H H0} {g h}%_function_scope p q r !x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 226
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** A tactic that generalizes [strip_truncations] to reflective subuniverses. [strip_truncations] introduces fewer universe variables, so tends to work better when removing truncations. [strip_modalities] in Modality.v also applies dependent elimination when [O] is a modality. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Ltac strip_reflections :=
  (** Search for hypotheses of type [O X] for some [O] such that the goal is [O]-local. *)
  progress repeat
    match goal with
    | [ T : _ |- _ ]
      =&gt; revert_opaque T;
        refine (@O_rec _ _ _ _ _ _ _) || refine (@O_indpaths _ _ _ _ _ _ _ _ _);
        (** Ensure that we didn't generate more than one subgoal, i.e. that the goal was appropriately local. *)
        [];
        intro T
  end.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Given [Funext], we prove the definition of reflective subuniverse in the book. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 240
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Instance isequiv_o_to_O `{Funext}
       (O : ReflectiveSubuniverse) (P Q : Type) `{In O Q}
: IsEquiv (fun g : O P -&gt; Q =&gt; g o to O P)
:= isequiv_ooextendable _ _ (extendable_to_O O).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 243
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

Definition equiv_o_to_O `{Funext}
           (O : ReflectiveSubuniverse) (P Q : Type) `{In O Q}
: (O P -&gt; Q) &lt;~&gt; (P -&gt; Q)
:= Build_Equiv _ _ (fun g : O P -&gt; Q =&gt; g o to O P) _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 248
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** [isequiv_ooextendable] is defined in a way that makes [O_rec] definitionally equal to the inverse of [equiv_o_to_O]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 250
Time: 0.019s">
<div class="time" style="width: 25%"></div>
<pre>Instance isequiv_O_rec_to_O `{Funext}
       (O : ReflectiveSubuniverse) (P Q : Type) `{In O Q}
  : IsEquiv (fun g : P -&gt; Q =&gt; O_rec g)
  := (equiv_isequiv (equiv_o_to_O O P Q)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Properties of Reflective Subuniverses *)

(** We now prove a bunch of things about an arbitrary reflective subuniverse. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 257
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section Reflective_Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 257
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : ReflectiveSubuniverse).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Functoriality of [O_rec] homotopies *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 261
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_rec_homotopy {P Q : Type} `{In O Q} (f g : P -&gt; Q) (pi : f == g)
  : O_rec (O := O) f == O_rec g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 262
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_indpaths; intro x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 264
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    etransitivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> etransitivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (pi _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry; apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 269
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 270
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** If [T] is in the subuniverse, then [to O T] is an equivalence. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance isequiv_to_O_inO (T : Type) `{In O T} : IsEquiv (to O T).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (g := O_rec idmap : O T -&gt; T).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (isequiv_adjointify (to O T) g _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (O_indpaths (to O T o g) idmap _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 279
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 280
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 281
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 281
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 282
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 283
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition equiv_to_O (T : Type) `{In O T} : T &lt;~&gt; O T
    := Build_Equiv T (O T) (to O T) _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section Functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** In this section, we see that [O] is a functor. *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 292
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition O_functor {A B : Type} (f : A -&gt; B) : O A -&gt; O B
      := O_rec (to O B o f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 293
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Naturality of [to O] *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 296
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition to_O_natural {A B : Type} (f : A -&gt; B)
    : (O_functor f) o (to O A) == (to O B) o f
    := (O_rec_beta _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Functoriality on composition *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 301
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition O_functor_compose {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
    : (O_functor (g o f)) == (O_functor g) o (O_functor f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 303
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      srapply O_indpaths; intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 304
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (to_O_natural (g o f) x @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 305
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      transitivity (O_functor g (to O B (f x))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 306
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (to_O_natural g (f x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 307
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ap; symmetry.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (to_O_natural f x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 309
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 310
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Functoriality on homotopies (2-functoriality) *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 313
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_functor_homotopy {A B : Type} (f g : A -&gt; B) (pi : f == g)
    : O_functor f == O_functor g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 314
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 315
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_indpaths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 316
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (to_O_natural f x @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 317
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (_ @ (to_O_natural g x)^).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ap, pi.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 319
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 320
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Functoriality for inverses of homotopies *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 323
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_functor_homotopy_V
               {A B : Type} (f g : A -&gt; B) (pi : f == g)
    : O_functor_homotopy g f (fun x =&gt; (pi x)^)
      == fun x =&gt; (O_functor_homotopy f g pi x)^.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 327
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_ind2paths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold composeD, O_functor_homotopy.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 329
Time: 0.009s">
<div class="time" style="width: 11.842105263158%"></div>
<pre>
      rewrite !O_indpaths_beta, !ap_V, !inv_pp, inv_V, !concat_p_pp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 330
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 331
Time: 0.008s">
<div class="time" style="width: 10.526315789474%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Hence functoriality on commutative squares *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 335
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition O_functor_square {A B C X : Type} (pi1 : X -&gt; A) (pi2 : X -&gt; B)
               (f : A -&gt; C) (g : B -&gt; C) (comm : (f o pi1) == (g o pi2))
    : ( (O_functor f) o (O_functor pi1) )
      == ( (O_functor g) o (O_functor pi2) ).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 338
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 339
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 340
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      transitivity (O_functor (f o pi1) x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 341
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 342
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> symmetry; rapply O_functor_compose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 342
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> transitivity (O_functor (g o pi2) x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 344
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_functor_homotopy, comm.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 344
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rapply O_functor_compose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 346
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Functoriality on identities *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 349
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_functor_idmap (A : Type)
    : @O_functor A A idmap == idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 350
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 351
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_indpaths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 353
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 354
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** 3-functoriality, as an example use of [O_ind2paths] *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 357
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition O_functor_2homotopy {A B : Type} {f g : A -&gt; B}
               (p q : f == g) (r : p == q)
    : O_functor_homotopy f g p == O_functor_homotopy f g q.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 359
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 360
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_ind2paths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 361
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_functor_homotopy, composeD.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 362
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      do 2 rewrite O_indpaths_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 363
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply whiskerL, whiskerR, ap, r.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 364
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (** Of course, if we wanted to prove 4-functoriality, we'd need to make this transparent. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 366
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 366
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** 2-naturality: Functoriality on homotopies is also natural *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 369
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition O_functor_homotopy_beta
               {A B : Type} (f g : A -&gt; B) (pi : f == g) (x : A)
    : O_functor_homotopy f g pi (to O A x)
      = to_O_natural f x
      @ ap (to O B) (pi x)
      @ (to_O_natural g x)^.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 374
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 375
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_functor_homotopy, to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 376
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_indpaths_beta _ _ _ x @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 377
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (concat_p_pp _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 378
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 379
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The pointed endofunctor ([O],[to O]) is well-pointed *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 382
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_functor_wellpointed (A : Type)
    : O_functor (to O A) == to O (O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 384
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_indpaths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 385
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 386
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 387
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** "Functoriality of naturality": the pseudonaturality axiom for composition *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 390
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition to_O_natural_compose {A B C : Type}
               (f : A -&gt; B) (g : B -&gt; C) (a : A)
    : ap (O_functor g) (to_O_natural f a)
      @ to_O_natural g (f a)
      = (O_functor_compose f g (to O A a))^
      @ to_O_natural (g o f) a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 395
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 396
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_functor_compose, to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 397
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      rewrite O_indpaths_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 398
Time: 0.019s">
<div class="time" style="width: 25%"></div>
<pre>
      rewrite !inv_pp, ap_V, !inv_V, !concat_pp_p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 399
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      rewrite concat_Vp, concat_p1; reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 400
Time: 0.012s">
<div class="time" style="width: 15.789473684211%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 401
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The pseudofunctoriality axiom *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 404
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition O_functor_compose_compose
               {A B C D : Type} (f : A -&gt; B) (g : B -&gt; C) (h : C -&gt; D)
               (a : O A)
    : O_functor_compose f (h o g) a
      @ O_functor_compose g h (O_functor f a)
      = O_functor_compose (g o f) h a
        @ ap (O_functor h) (O_functor_compose f g a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 410
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 411
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      revert a; refine (O_ind2paths _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 412
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      intros a; unfold composeD, O_functor_compose; cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 413
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Open Scope long_path_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 414
Time: 0.026s">
<div class="time" style="width: 34.210526315789%"></div>
<pre>
      rewrite !O_indpaths_beta, !ap_pp, !ap_V, !concat_p_pp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 415
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      refine (whiskerL _ (apD _ (to_O_natural f a)^)^ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 416
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      rewrite O_indpaths_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 417
Time: 0.023s">
<div class="time" style="width: 30.263157894737%"></div>
<pre>
      rewrite transport_paths_FlFr, !concat_p_pp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 418
Time: 0.008s">
<div class="time" style="width: 10.526315789474%"></div>
<pre>
      rewrite !ap_V, inv_V.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 419
Time: 0.006s">
<div class="time" style="width: 7.8947368421053%"></div>
<pre>
      rewrite !concat_pV_p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 420
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply whiskerL.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 421
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply inverse2.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 421
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ap_compose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 422
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Close Scope long_path_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 423
Time: 0.076s">
<div class="time" style="width: 100%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 424
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Preservation of equivalences *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 427
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance isequiv_O_functor {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
    : IsEquiv (O_functor f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 429
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (isequiv_adjointify (O_functor f) (O_functor f^-1) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 430
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 431
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 431
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine ((O_functor_compose _ _ x)^ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 432
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine (O_functor_homotopy _ idmap _ x @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 433
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 434
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros y; apply eisretr.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 434
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_functor_idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 436
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 436
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine ((O_functor_compose _ _ x)^ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 437
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine (O_functor_homotopy _ idmap _ x @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 438
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 439
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros y; apply eissect.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 439
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 440
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_functor_idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 440
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 441
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition equiv_O_functor {A B : Type} (f : A &lt;~&gt; B)
    : O A &lt;~&gt; O B
    := Build_Equiv _ _ (O_functor f) _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 445
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** This is sometimes useful to have a separate name for, to facilitate rewriting along it. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 448
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition to_O_equiv_natural {A B} (f : A &lt;~&gt; B)
    : (equiv_O_functor f) o (to O A) == (to O B) o f
    := to_O_natural f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** This corresponds to [ap O] on the universe. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition ap_O_path_universe' `{Univalence}
               {A B : Type} (f : A &lt;~&gt; B)
    : ap O (path_universe_uncurried f)
      = path_universe_uncurried (equiv_O_functor f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 456
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 457
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      revert f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 458
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      equiv_intro (equiv_path A B) p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 459
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (ap (ap O) (eta_path_universe p) @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 460
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      destruct p; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 461
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply moveL_equiv_V.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 462
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_equiv, path_arrow, O_indpaths; intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 463
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      symmetry; apply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 464
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 465
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition ap_O_path_universe `{Univalence}
               {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
    : ap O (path_universe f) = path_universe (O_functor f)
    := ap_O_path_universe' (Build_Equiv _ _ f _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Postcomposition respects [O_rec] *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 473
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition O_rec_postcompose {A B C : Type@{i}} `{In O B} {C_inO : In O C}
               (f : A -&gt; B) (g : B -&gt; C)
    : g o O_rec (O := O) f == O_rec (O := O) (g o f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 475
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 476
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_indpaths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 477
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      transitivity (g (f x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 478
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 479
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 479
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 479
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 480
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 480
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_rec_beta (g o f) x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 480
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 481
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** In particular, we have: *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 484
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition O_rec_postcompose_to_O {A B : Type} (f : A -&gt; B) `{In O B}
    : to O B o O_rec f == O_functor f
    := O_rec_postcompose f (to O B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 486
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  End Functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 488
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section Replete.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 490
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** An equivalent formulation of repleteness is that a type lies in the subuniverse as soon as its unit map is an equivalence. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 493
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition inO_isequiv_to_O (T:Type)
    : IsEquiv (to O T) -&gt; In O T
    := fun _ =&gt; inO_equiv_inO (O T) (to O T)^-1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 495
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** We don't make this an ordinary instance, but we allow it to solve [In O] constraints if we already have [IsEquiv] as a hypothesis. [Hint Immediate] doesn't support #[export] in Sections, so we repeat this at the end of the file. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 498
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[local]
    Hint Immediate inO_isequiv_to_O : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 499
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition inO_iff_isequiv_to_O (T:Type)
    : In O T &lt;-&gt; IsEquiv (to O T).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 502
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 503
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      split; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 504
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 505
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Thus, [T] is in a subuniverse as soon as [to O T] admits a retraction. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 508
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_to_O_retract (T:Type) (mu : O T -&gt; T)
    : mu o (to O T) == idmap -&gt; In O T.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 509
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 510
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros H.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 511
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply inO_isequiv_to_O.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 512
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply isequiv_adjointify with (g:=mu).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 513
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (O_indpaths (to O T o mu) idmap _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        intros x; exact (ap (to O T) (H x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 515
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact H.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 516
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 517
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** It follows that reflective subuniverses are closed under retracts. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 520
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_retract_inO (A B : Type) `{In O B} (s : A -&gt; B) (r : B -&gt; A)
      (K : r o s == idmap)
      : In O A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 522
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 523
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      napply (inO_to_O_retract A (r o (to O B)^-1 o (O_functor s))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 524
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intro a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 525
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      lhs exact (ap (r o (to O B)^-1) (to_O_natural s a)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 526
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      lhs nrefine (ap r (eissect _ (s a))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 527
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply K.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 528
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 529
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End Replete.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 531
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The maps that are inverted by the reflector.  Note that this notation is not (yet) global (because notations in a section cannot be made global); it only exists in this section.  After the section is over, we will redefine it globally. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Local Notation O_inverts f := (IsEquiv (O_functor f)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 534
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section OInverts.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 536
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[export] Instance O_inverts_O_unit (A : Type)
    : O_inverts (to O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 539
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 540
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      refine (isequiv_homotopic (to O (O A)) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 541
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros x; symmetry; apply O_functor_wellpointed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 542
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 543
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** A map between modal types that is inverted by [O] is already an equivalence.  This can't be an [Instance], probably because it causes an infinite regress applying more and more [O_functor]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 546
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isequiv_O_inverts {A B : Type} `{In O A} `{In O B}
      (f : A -&gt; B) `{O_inverts f}
    : IsEquiv f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 548
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 549
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      refine (isequiv_commsq' f (O_functor f) (to O A) (to O B) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 550
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Strangely, even this seems to cause infinite loops *)
    (** [Hint Immediate isequiv_O_inverts : typeclass_instances.] *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 557
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition equiv_O_inverts {A B : Type} `{In O A} `{In O B}
      (f : A -&gt; B) `{O_inverts f}
    : A &lt;~&gt; B
    := Build_Equiv _ _ f (isequiv_O_inverts f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 560
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition isequiv_O_rec_O_inverts
           {A B : Type} `{In O B} (f : A -&gt; B) `{O_inverts f}
    : IsEquiv (O_rec (O := O) f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 564
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 565
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (* Not sure why we need [C:=O B] on the next line to get Coq to use two typeclass instances. *)
     </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 567
Time: 0.006s">
<div class="time" style="width: 7.8947368421053%"></div>
<pre>rapply (cancelL_isequiv (C:=O B) (to O B)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 567
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      exact (isequiv_homotopic (O_functor f) (fun x =&gt; (O_rec_postcompose_to_O f x)^)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 568
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 569
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition equiv_O_rec_O_inverts
           {A B : Type} `{In O B} (f : A -&gt; B) `{O_inverts f}
      : O A &lt;~&gt; B
      := Build_Equiv _ _ _ (isequiv_O_rec_O_inverts f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 574
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>

    Definition isequiv_to_O_O_inverts
           {A B : Type} `{In O A} (f : A -&gt; B) `{O_inverts f}
      : IsEquiv (to O B o f)
      := isequiv_homotopic (O_functor f o to O A) (to_O_natural f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition equiv_to_O_O_inverts
           {A B : Type} `{In O A} (f : A -&gt; B) `{O_inverts f}
      : A &lt;~&gt; O B
      := Build_Equiv _ _ _ (isequiv_to_O_O_inverts f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 584
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** If [f] is inverted by [O], then mapping out of it into any modal type is an equivalence.  First we prove a version not requiring funext.  For use in [O_inverts_O_leq] below, we allow the types [A], [B], and [Z] to perhaps live in smaller universes than the one [i] on which our subuniverse lives.  This the first half of Lemma 1.23 of RSS. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 587
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition ooextendable_O_inverts@{a b z i}
               {A : Type@{a}} {B : Type@{b}} (f : A -&gt; B) `{O_inverts f}
               (Z : Type@{z}) `{In@{i} O Z}
      : ooExtendableAlong@{a b z i} f (fun _ =&gt; Z).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 590
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 591
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (cancelL_ooextendable@{a b i z i i i i i} _ _ (to O B) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 592
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      1:exact (extendable_to_O'@{i b z} O B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 593
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (ooextendable_homotopic _ (O_functor f o to O A) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 594
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      1:apply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 595
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (ooextendable_compose _ (to O A) (O_functor f) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 596
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 597
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> srapply ooextendable_equiv.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 597
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 598
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (extendable_to_O'@{i a z} O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 598
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 599
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** And now the funext version *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 602
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isequiv_precompose_O_inverts `{Funext}
               {A B : Type} (f : A -&gt; B) `{O_inverts f}
               (Z : Type) `{In O Z}
      : IsEquiv (fun g:B-&gt;Z =&gt; g o f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 605
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 606
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      srapply (equiv_extendable_isequiv 0).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 607
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ooextendable_O_inverts f Z 2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 608
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 609
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Conversely, if a map is inverted by the representable functor [? -&gt; Z] for all [O]-modal types [Z], then it is inverted by [O].  As before, first we prove a version that doesn't require funext. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 612
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_inverts_from_extendable
               {A : Type@{i}} {B : Type@{j}} (f : A -&gt; B)
               (** Without the universe annotations, the result ends up insufficiently polymorphic. *)
               (e : forall (Z:Type@{k}), In O Z -&gt; ExtendableAlong@{i j k l} 2 f (fun _ =&gt; Z))
      : O_inverts f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 616
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 617
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      srapply isequiv_adjointify.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 618
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 619
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_rec (fst (e (O A) _) (to O A)).1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 619
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 620
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> srapply O_indpaths.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 620
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 620
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 621
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        assert (e1 := fun h k =&gt; fst (snd (e (O B) _) h k)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 622
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> cbn in e1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 622
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine ((e1 (fun y =&gt; O_functor f ((fst (e (O A) _) (to O A)).1 y)) (to O B) _).1 b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 623
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 624
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        rewrite ((fst (e (O A) (O_inO A)) (to O A)).2 a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 625
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 626
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> srapply O_indpaths.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite to_O_natural, O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 628
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact ((fst (e (O A) (O_inO A)) (to O A)).2 a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 629
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 630
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[local] Hint Extern 4 =&gt; progress (cbv beta iota) : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 632
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** And the version with funext.  Use it with universe parameters [i j k l lplus l l l l]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 635
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_inverts_from_isequiv_precompose `{Funext}
               {A B : Type} (f : A -&gt; B)
               (e : forall (Z:Type), In O Z -&gt; IsEquiv (fun g:B-&gt;Z =&gt; g o f))
      : O_inverts f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 638
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 639
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_inverts_from_extendable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 640
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros Z ?.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 641
Time: 0.008s">
<div class="time" style="width: 10.526315789474%"></div>
<pre>
      rapply ((equiv_extendable_isequiv 0 _ _)^-1%equiv).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 642
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 643
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** This property also characterizes the types in the subuniverse, which is the other half of Lemma 1.23. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 646
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_ooextendable_O_inverts (Z:Type@{k})
               (E : forall (A : Type@{i}) (B : Type@{j}) (f : A -&gt; B)
                      (Oif : O_inverts f),
                   ooExtendableAlong f (fun _ =&gt; Z))
      : In O Z.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 650
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 651
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (EZ := fst (E Z (O Z) (to O Z) _ 1%nat) idmap).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 652
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (inO_to_O_retract _ EZ.1 EZ.2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 653
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 654
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** A version with the equivalence form of the extension condition. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 657
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_isequiv_precompose_O_inverts (Z:Type)
               (Yo : forall (A : Type) (B : Type) (f : A -&gt; B)
                       (Oif : O_inverts f),
                   IsEquiv (fun g:B-&gt;Z =&gt; g o f))
      : In O Z.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 661
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 662
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (EZ := extension_isequiv_precompose (to O Z) _ (Yo Z (O Z) (to O Z) _) idmap).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 663
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (inO_to_O_retract _ EZ.1 EZ.2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 664
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 665
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition to_O_inv_natural {A B : Type} `{In O A} `{In O B}
               (f : A -&gt; B)
    : (to O B)^-1 o (O_functor f) == f o (to O A)^-1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 669
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 670
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_indpaths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 671
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 672
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (to_O_natural f x @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 673
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      do 2 apply ap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 674
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      symmetry; apply eissect.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 675
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 676
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Two maps between modal types that become equal after applying [O_functor] are already equal. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 679
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_functor_faithful_inO {A B : Type} `{In O A} `{In O B}
      (f g : A -&gt; B) (e : O_functor f == O_functor g)
      : f == g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 681
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 683
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (ap f (eissect (to O A) x)^ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 684
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (_ @ ap g (eissect (to O A) x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 685
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      transitivity ((to O B)^-1 (O_functor f (to O A x))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 686
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 687
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry; apply to_O_inv_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 687
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 688
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> transitivity ((to O B)^-1 (O_functor g (to O A x))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 688
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 689
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ap, e.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 689
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        *</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 690
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply to_O_inv_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 690
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 691
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Any map to a type in the subuniverse that is inverted by [O] must be equivalent to [to O].  More precisely, the type of such maps is contractible. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 694
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition typeof_to_O (A : Type)
      := { OA : Type &amp; { Ou : A -&gt; OA &amp; ((In O OA) * (O_inverts Ou)) }}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 695
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[export] Instance contr_typeof_O_unit `{Univalence} (A : Type)
    : Contr (typeof_to_O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 698
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 699
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply (Build_Contr _ (O A ; (to O A ; (_ , _)))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 700
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [OA [Ou [? ?]]].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 701
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (f := O_rec Ou : O A -&gt; OA).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 702
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (g := (O_functor Ou)^-1 o to O OA : (OA -&gt; O A)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 703
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      assert (IsEquiv f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 704
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 705
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (isequiv_adjointify f g _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 705
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 706
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_functor_faithful_inO; intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 706
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          rewrite O_functor_idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 707
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          rewrite O_functor_compose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 708
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          unfold g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 709
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          rewrite (O_functor_compose (to O OA) (O_functor Ou)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 710
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          rewrite O_functor_wellpointed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 711
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          rewrite (to_O_natural (O_functor Ou)^-1 x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 712
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          refine (to_O_natural f _ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 713
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          set (y := (O_functor Ou)^-1 x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 714
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          transitivity (O_functor Ou y); [ | apply eisretr].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 715
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          unfold f, O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 716
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply O_rec_postcompose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 717
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 718
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (O_indpaths _ _ _); intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 718
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          unfold f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 719
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 720
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> unfold g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 720
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply moveR_equiv_V.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 721
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          symmetry; apply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 722
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 723
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      simple refine (path_sigma _ _ _ _ _); cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 724
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 725
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (path_universe f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 725
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 726
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rewrite transport_sigma.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 726
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
        simple refine (path_sigma _ _ _ _ _); cbn; [ | apply path_ishprop].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 727
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply path_arrow; intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 728
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite transport_arrow_fromconst.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 729
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite transport_path_universe.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 730
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        unfold f; apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 731
Time: 0.009s">
<div class="time" style="width: 11.842105263158%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 732
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End OInverts.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 734
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section Types.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** The [Unit] type *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_unit : In O Unit.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 740
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply inO_to_O_retract@{Set} with (mu := fun x =&gt; tt).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 741
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (@contr@{Set} Unit _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 742
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 743
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** It follows that any contractible type is in [O]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 746
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_contr {A : Type} `{Contr A} : In O A | 2.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 746
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 747
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (inO_equiv_inO@{Set _ _} Unit equiv_contr_unit^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 748
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 749
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** And that the reflection of a contractible type is still contractible. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 752
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[global] Instance contr_O_contr {A : Type} `{Contr A} : Contr (O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 752
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 753
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (contr_equiv A (to O A)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 754
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 755
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Dependent product and arrows *)
    (** Theorem 7.7.2 *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 759
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_forall {fs : Funext} (A:Type) (B:A -&gt; Type)
    : (forall x, (In O (B x)))
      -&gt; (In O (forall x:A, (B x))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 761
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 762
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intro H.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 763
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (ev := fun x =&gt; (fun (f:(forall x, (B x))) =&gt; f x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 764
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (zz := fun x:A =&gt; O_rec (O := O) (ev x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 765
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply inO_to_O_retract with (mu := fun z =&gt; fun x =&gt; zz x z).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 766
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intro phi.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 767
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold zz, ev; clear zz; clear ev.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 768
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_forall; intro x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 769
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (O_rec_beta (fun f : forall x0, (B x0) =&gt; f x) phi).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 770
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 771
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[export] Instance inO_arrow {fs : Funext} (A B : Type) `{In O B}
    : In O (A -&gt; B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 774
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 775
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply inO_forall.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 776
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intro a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 777
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 777
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 778
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Product *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 781
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_prod (A B : Type) `{In O A} `{In O B}
    : In O (A*B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 782
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 783
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply inO_to_O_retract with
        (mu := fun X =&gt; (@O_rec _ (A * B) A _ _ _ fst X , O_rec snd X)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 785
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [a b]; apply path_prod; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 786
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 787
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_rec_beta fst (a,b)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 787
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 788
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_rec_beta snd (a,b)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 788
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 789
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Two ways to define a map [O(A * B) -&gt; X * Y] agree. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 792
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition O_rec_functor_prod {A B X Y : Type} `{In O X} `{In O Y}
      (f : A -&gt; X) (g : B -&gt; Y)
      : O_rec (functor_prod f g) == prod_coind (O_rec (f o fst : A * B -&gt; X))
                                               (O_rec (g o snd : A * B -&gt; Y)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 795
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 796
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_indpaths; intro ab.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 797
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold functor_prod, prod_coind, prod_coind_uncurried; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 798
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      lhs (napply O_rec_beta).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 799
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      apply path_prod; cbn; symmetry; napply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 800
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 801
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** We show that [OA*OB] has the same universal property as [O(A*B)] *)

    (** Here is the map witnessing the universal property.  *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 806
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_prod_unit (A B : Type) : A * B -&gt; O A * O B
      := functor_prod (to O A) (to O B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 807
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** We express the universal property without funext, using extensions. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 810
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition ooextendable_O_prod_unit (A B C : Type) `{In O C}
      : ooExtendableAlong (O_prod_unit A B) (fun _ =&gt; C).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 811
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 812
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ooextendable_functor_prod.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 813
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      all:intros; rapply extendable_to_O.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 814
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 815
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Here's the version with funext. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 818
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isequiv_O_prod_unit_precompose
               {fs : Funext} (A B C : Type) `{In O C}
      : IsEquiv (fun (f : (O A) * (O B) -&gt; C) =&gt; f o O_prod_unit A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 820
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 821
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      rapply isequiv_ooextendable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 822
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      rapply ooextendable_O_prod_unit.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 823
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 824
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition equiv_O_prod_unit_precompose
               {fs : Funext} (A B C : Type) `{In O C}
      : ((O A) * (O B) -&gt; C) &lt;~&gt; (A * B -&gt; C)
      := Build_Equiv _ _ _ (isequiv_O_prod_unit_precompose A B C).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 829
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The (funext-free) universal property implies that [O_prod_unit] is an [O]-equivalence, hence induces an equivalence between [O (A*B)] and [O A * O B]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 832
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance O_inverts_O_prod_unit (A B : Type)
      : O_inverts (O_prod_unit A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 833
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 834
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rapply O_inverts_from_extendable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 835
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      intros; rapply ooextendable_O_prod_unit.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 836
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 837
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition O_prod_cmp (A B : Type) : O (A * B) -&gt; O A * O B
      := O_rec (O_prod_unit A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 840
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[export] Instance isequiv_O_prod_cmp (A B : Type)
      : IsEquiv (O_prod_cmp A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 843
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 844
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rapply isequiv_O_rec_O_inverts.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 845
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 846
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition equiv_O_prod_cmp (A B : Type)
      : O (A * B) &lt;~&gt; (O A * O B)
      := Build_Equiv _ _ (O_prod_cmp A B) _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 850
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition equiv_path_O_prod {X Y : Type} {x0 x1 : X} {y0 y1 : Y}
      : (to O _ (x0, y0) = to O _ (x1, y1))
          &lt;~&gt; (to O _ x0 = to O _ x1) * (to O _ y0 = to O _ y1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 854
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 855
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (_ oE equiv_ap' (equiv_O_prod_cmp _ _) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 856
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (_ oE equiv_concat_lr _ _); only 2: symmetry.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 857
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      2,3: apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 858
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (equiv_path_prod _ _)^-1%equiv.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 859
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 860
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition O_prod_cmp_coind (A B : Type)
      : O_prod_cmp A B == prod_coind (O_rec (to O _ o fst : A * B -&gt; O A))
                                     (O_rec (to O _ o snd : A * B -&gt; O B))
      := O_rec_functor_prod _ _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 865
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Pullbacks *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 869
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_pullback {A B C} (f : B -&gt; A) (g : C -&gt; A)
           `{In O A} `{In O B} `{In O C}
      : In O (Pullback f g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 871
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 872
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      srapply inO_to_O_retract.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 873
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 874
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros op.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 874
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (O_rec pr1 op).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 875
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (O_rec (fun p =&gt; p.2.1) op).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 876
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        revert op; apply O_indpaths; intros [b [c a]].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 877
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        refine (ap f (O_rec_beta _ _) @ _); cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 878
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (a @ ap g (O_rec_beta _ _)^).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 879
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 880
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre> intros [b [c a]]; cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 880
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
        srapply path_sigma'.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 881
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 882
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 882
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 882
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        refine (transport_sigma' _ _ @ _); cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 883
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
        srapply path_sigma'.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 884
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 885
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 885
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 885
Time: 0.033s">
<div class="time" style="width: 43.421052631579%"></div>
<pre>
        abstract (
          rewrite transport_paths_Fr;
          rewrite transport_paths_Fl;
          rewrite O_indpaths_beta;
          rewrite concat_V_pp;
          rewrite ap_V;
          apply concat_pV_p ).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 892
Time: 0.023s">
<div class="time" style="width: 30.263157894737%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 893
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Fibers *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 897
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_hfiber {A B : Type} `{In O A} `{In O B}
           (f : A -&gt; B) (b : B)
    : In O (hfiber f b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 899
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 900
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      simple refine (inO_to_O_retract _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 901
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 902
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x; simple refine (_;_).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 902
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 903
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_rec pr1 x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 903
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> revert x; apply O_indpaths; intros x; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          refine (ap f (O_rec_beta pr1 x) @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 905
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          exact (x.2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 906
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 907
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [a p]; simple refine (path_sigma' _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 907
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 908
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_rec_beta pr1 (a;p)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 908
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 909
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (ap (transport _ _) (O_indpaths_beta _ _ _ _) @ _); simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 909
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          refine (transport_paths_Fl _ _ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 910
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          apply concat_V_pp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 911
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 912
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition inO_unsigma {A : Type} (B : A -&gt; Type)
               `{In O A} {B_inO : In O {x:A &amp; B x}} (x : A)
    : In O (B x)
    := inO_equiv_inO _ (hfiber_fibration x B)^-1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[local]
    Hint Immediate inO_unsigma : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 920
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The reflector preserving hfibers is a characterization of lex modalities.  Here is the comparison map. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 923
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_functor_hfiber {A B} (f : A -&gt; B) (b : B)
    : O (hfiber f b) -&gt; hfiber (O_functor f) (to O B b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 924
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 925
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      apply O_rec.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 926
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [a p].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 926
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exists (to O A a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 927
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (to_O_natural f a @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 928
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ap, p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 929
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 930
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition O_functor_hfiber_natural {A B} (f : A -&gt; B) (b : B)
      : (O_functor_hfiber f b) o to O (hfiber f b) == functor_hfiber (fun u =&gt; (to_O_natural f u)^) b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 933
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 934
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      intros [a p]; unfold O_functor_hfiber, functor_hfiber, functor_sigma; cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 935
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (O_rec_beta _ _ @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 936
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ap _ (inv_V _ @@ 1))^.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 937
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 938
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** [functor_sigma] over [idmap] preserves [O]-equivalences. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 941
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_inverts_functor_sigma_id {A} {P Q : A -&gt; Type}
           (g : forall a, P a -&gt; Q a) `{forall a, O_inverts (g a)}
      : O_inverts (functor_sigma idmap g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 943
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 944
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_inverts_from_extendable; intros Z Z_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 945
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply ooextendable_functor_sigma_id; intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 946
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      napply ooextendable_O_inverts; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 947
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 948
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Theorem 7.3.9: The reflector [O] can be discarded inside a reflected sum.  This can be obtained from [O_inverts_functor_sigma_id] applied to the family of units [to O (P x)], but unfortunately the definitional behavior of the inverse obtained thereby (which here we take as the "forwards" direction) is poor.  So instead we give an explicit proof, but note that the "backwards" direction here is precisely [functor_sigma]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 951
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition equiv_O_sigma_O {A} (P : A -&gt; Type)
      : O {x:A &amp; O (P x)} &lt;~&gt; O {x:A &amp; P x}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 952
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      (** := (Build_Equiv _ _ _ (O_inverts_functor_sigma_id (fun x =&gt; to O (P x))))^-1. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      srapply equiv_adjointify.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 955
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_rec; intros [a op]; revert op.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply O_rec; intros p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 957
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (to O _ (a;p)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 959
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 959
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (functor_sigma idmap (fun x =&gt; to O (P x))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 960
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 961
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> unfold O_functor; rapply O_indpaths.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 961
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        intros [a p]; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 962
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
        abstract (repeat (rewrite O_rec_beta); reflexivity).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 963
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 964
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> unfold O_functor; rapply O_indpaths.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 964
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
        intros [a op]; revert op; rapply O_indpaths; intros p; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 965
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
        abstract (repeat (rewrite O_rec_beta); reflexivity).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 966
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 967
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Equivalences *)

    (** Naively it might seem that we need closure under Sigmas (hence a modality) to deduce closure under [Equiv], but in fact the above closure under fibers is sufficient.  This appears as part of the proof of Proposition 2.18 of CORS.  For later use, we try to reduce the number of universe parameters (but we don't completely control them all). *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 972
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_equiv `{Funext} (A : Type@{i}) (B : Type@{j})
           `{In O A} `{In O B}
      : In O (A &lt;~&gt; B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 974
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 975
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      refine (inO_equiv_inO _ (issig_equiv@{i j k} A B)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 976
Time: 0.007s">
<div class="time" style="width: 9.2105263157895%"></div>
<pre>
      refine (inO_equiv_inO _ (equiv_functor_sigma equiv_idmap@{k}
                                 (fun f =&gt; equiv_biinv_isequiv@{i j k} f))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 978
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      transparent assert (c : (prod@{k k} (A-&gt;B) (prod@{k k} (B-&gt;A) (B-&gt;A)) -&gt; prod@{k k} (A -&gt; A) (B -&gt; B))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 979
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 980
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [f [g h]]; exact (h o f, f o g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 980
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 980
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      pose (U := hfiber@{k k} c (idmap, idmap)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 981
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      refine (inO_equiv_inO'@{k k k} U _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 982
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (** Introduces some extra copies of [k] by typeclass inference. *)
     </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>unfold hfiber, BiInv; cbn in *.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      srefine (equiv_adjointify _ _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 984
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 985
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [[f [g h]] p].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 985
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply (equiv_inverse (equiv_path_prod _ _)) in p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 986
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        destruct p as [p q]; cbn in *.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 987
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists f; split; [ exists h | exists g ].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 988
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        all:apply ap10; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 989
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 990
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [f [[g p] [h q]]].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 990
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exists (f,(h,g)); cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 991
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply path_prod; apply path_arrow; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 992
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 993
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre> intros [f [[g p] [h q]]]; cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 993
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
        apply (path_sigma' _ 1); apply path_prod; apply (path_sigma' _ 1);
          cbn; rewrite transport_1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 995
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        1:rewrite ap_fst_path_prod.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 996
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        2:rewrite ap_snd_path_prod.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 997
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        all:apply path_forall; intros x; rewrite ap10_path_arrow; reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 998
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 999
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> intros fghp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 999
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 999
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        apply (path_sigma' _ 1); cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1000
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        refine (_ @ eta_path_prod (pr2 fghp)); apply ap011; apply eta_path_arrow.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1001
Time: 0.018s">
<div class="time" style="width: 23.684210526316%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1002
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Paths *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1006
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition inO_paths@{i} (S : Type@{i}) {S_inO : In O S} (x y : S)
    : In O (x=y).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1007
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1008
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      simple refine (inO_to_O_retract@{i} _ _ _); intro u.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1009
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1010
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> assert (p : (fun _ : O (x=y) =&gt; x) == (fun _=&gt; y)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1010
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1011
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (O_indpaths _ _ _); simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1011
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
          intro v; exact v.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1012
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1012
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (p u).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1013
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1014
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1014
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rewrite O_indpaths_beta; reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1015
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1016
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    #[export] Existing Instance inO_paths.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1017
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Lemma O_concat {A : Type} {a0 a1 a2 : A}
      : O (a0 = a1) -&gt; O (a1 = a2) -&gt; O (a0 = a2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1020
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1021
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros p q.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1022
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      strip_reflections.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1023
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (to O _ (p @ q)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1024
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1025
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Truncations  *)

    (** The reflector preserves hprops (and, as we have already seen, contractible types), although it doesn't generally preserve [n]-types for other [n]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1030
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance ishprop_O_ishprop {A} `{IsHProp A} : IsHProp (O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1030
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1031
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre>
      refine ishprop_isequiv_diag.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1032
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre>
      refine (isequiv_homotopic (O_prod_cmp A A
                               o O_functor (fun (a:A) =&gt; (a,a))) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1034
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      apply O_indpaths; intros x; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1035
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (ap (O_prod_cmp A A) (to_O_natural (fun (a:A) =&gt; (a,a)) x) @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1036
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_prod_cmp; apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1037
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1038
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** If [A] is [In O], then so is [IsTrunc n A]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1041
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance inO_istrunc `{Funext} {n} {A} `{In O A}
    : In O (IsTrunc n A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1042
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1043
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      generalize dependent A; simple_induction n n IH; intros A ?.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1044
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1045
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (** We have to be slightly clever here: the actual definition of [Contr] involves a sigma, which [O] is not generally closed under, but fortunately we have [equiv_contr_inhabited_allpath]. *)
       </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1046
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>exact (inO_equiv_inO _ equiv_contr_inhabited_allpath^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1046
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1047
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre> exact (inO_equiv_inO _ (equiv_istrunc_unfold n.+1 A)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1047
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1048
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Coproducts *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1052
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_inverts_functor_sum {A B A' B'} (f : A -&gt; A') (g : B -&gt; B')
               `{O_inverts f} `{O_inverts g}
      : O_inverts (functor_sum f g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1054
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1055
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_inverts_from_extendable; intros.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1056
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply extendable_functor_sum; apply ooextendable_O_inverts; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1057
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1058
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition equiv_O_functor_sum {A B A' B'} (f : A -&gt; A') (g : B -&gt; B')
               `{O_inverts f} `{O_inverts g}
      : O (A + B) &lt;~&gt; O (A' + B')
      := Build_Equiv _ _ _ (O_inverts_functor_sum f g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1063
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition equiv_O_sum {A B} :
      O (A + B) &lt;~&gt; O (O A + O B)
      := equiv_O_functor_sum (to O A) (to O B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1067
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Coequalizers *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1071
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section OCoeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1071
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Context {B A : Type} (f g : B -&gt; A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1072
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

      Definition O_inverts_functor_coeq
                 {B' A' : Type} {f' g' : B' -&gt; A'}
                 (h : B -&gt; B') (k : A -&gt; A')
                 (p : k o f == f' o h) (q : k o g == g' o h)
                 `{O_inverts k} `{O_inverts h}
        : O_inverts (functor_coeq h k p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1079
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1080
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply O_inverts_from_extendable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1081
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        intros Z Z_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1082
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply extendable_functor_coeq'.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1083
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
        all:napply ooextendable_O_inverts; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1084
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1085
Time: 0.007s">
<div class="time" style="width: 9.2105263157895%"></div>
<pre>

      Definition equiv_O_functor_coeq
                 {B' A' : Type} (f' g' : B' -&gt; A')
                 (h : B -&gt; B') (k : A -&gt; A')
                 (p : k o f == f' o h) (q : k o g == g' o h)
                 `{O_inverts k} `{O_inverts h}
        : O (Coeq f g) &lt;~&gt; O (Coeq f' g')
        := Build_Equiv _ _ _ (O_inverts_functor_coeq h k p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1093
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

      Definition coeq_cmp : Coeq f g -&gt; Coeq (O_functor f) (O_functor g)
        := functor_coeq (to O B) (to O A)
                       (fun y =&gt; (to_O_natural f y)^)
                       (fun y =&gt; (to_O_natural g y)^).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1098
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

      #[export] Instance isequiv_O_coeq_cmp : O_inverts coeq_cmp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1100
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1101
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
        rapply O_inverts_functor_coeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1102
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1103
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

      Definition equiv_O_coeq
      : O (Coeq f g) &lt;~&gt; O (Coeq (O_functor f) (O_functor g))
        := Build_Equiv _ _ (O_functor coeq_cmp) _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1107
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

      Definition equiv_O_coeq_to_O (a : A)
        : equiv_O_coeq (to O (Coeq f g) (coeq a))
          = to O (Coeq (O_functor f) (O_functor g)) (coeq (to O A a)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (to_O_natural _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1114
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

      Definition inverse_equiv_O_coeq_to_O (a : A)
        : equiv_O_coeq^-1 (to O (Coeq (O_functor f) (O_functor g)) (coeq (to O A a)))
          = to O (Coeq f g) (coeq a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1118
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1119
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply moveR_equiv_V; symmetry; apply equiv_O_coeq_to_O.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1120
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1121
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    End OCoeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1123
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** ** Pushouts *)

   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section OPushout.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Context {A B C : Type} (f : A -&gt; B) (g : A -&gt; C).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1128
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

      Definition O_inverts_functor_pushout
             {A' B' C'} {f' : A' -&gt; B'} {g' : A' -&gt; C'}
             (h : A -&gt; A') (k : B -&gt; B') (l : C -&gt; C')
             (p : k o f == f' o h) (q : l o g == g' o h)
             `{O_inverts h} `{O_inverts k} `{O_inverts l}
        : O_inverts (functor_pushout h k l p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1135
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1136
Time: 0.011s">
<div class="time" style="width: 14.473684210526%"></div>
<pre>
        rapply O_inverts_functor_coeq; rapply O_inverts_functor_sum.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1137
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1138
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

      Definition equiv_O_pushout
        : O (Pushout f g) &lt;~&gt; O (Pushout (O_functor f) (O_functor g))
        := Build_Equiv _ _ _ (O_inverts_functor_pushout (to O A) (to O B) (to O C)
                                                        (fun x =&gt; (to_O_natural f x)^)
                                                        (fun x =&gt; (to_O_natural g x)^)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1144
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

      Definition equiv_O_pushout_to_O_pushl (b : B)
        : equiv_O_pushout (to O (Pushout f g) (pushl b))
          = to O (Pushout (O_functor f) (O_functor g)) (pushl (to O B b)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1148
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1149
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1150
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rapply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1151
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1152
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

      Definition equiv_O_pushout_to_O_pushr (c : C)
        : equiv_O_pushout (to O (Pushout f g) (pushr c))
          = to O (Pushout (O_functor f) (O_functor g)) (pushr (to O C c)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1156
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1157
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        rapply to_O_natural.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1160
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>

      Definition inverse_equiv_O_pushout_to_O_pushl (b : B)
        : equiv_O_pushout^-1 (to O (Pushout (O_functor f) (O_functor g)) (pushl (to O B b)))
          = to O (Pushout f g) (pushl b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1164
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply moveR_equiv_V; symmetry; apply equiv_O_pushout_to_O_pushl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1166
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1167
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>

      Definition inverse_equiv_O_pushout_to_O_pushr (c : C)
        : equiv_O_pushout^-1 (to O (Pushout (O_functor f) (O_functor g)) (pushr (to O C c)))
          = to O (Pushout f g) (pushr c).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1171
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1172
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply moveR_equiv_V; symmetry; apply equiv_O_pushout_to_O_pushr.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1173
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1174
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    End OPushout.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1176
Time: 0.007s">
<div class="time" style="width: 9.2105263157895%"></div>
<pre>

  End Types.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1178
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section Decidable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1180
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** If [Empty] belongs to [O], then [O] preserves decidability. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1183
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance decidable_O `{In O Empty} (A : Type) `{Decidable A}
    : Decidable (O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1184
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1185
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      destruct (dec A) as [y|n].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1186
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inl (to O A y)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1187
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (inr (O_rec n)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1188
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1189
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** Dually, if [O A] is decidable, then [O (Decidable A)]. *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1192
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_decidable (A : Type) `{Decidable (O A)}
    : O (Decidable A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1193
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1194
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      destruct (dec (O A)) as [y|n].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1195
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_functor inl y).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1196
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1197
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (O_functor inr _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1197
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply to; intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1198
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        exact (n (to O A a)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1199
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1200
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End Decidable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1202
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section Monad.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1204
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition O_monad_mult (A : Type) : O (O A) -&gt; O A
      := O_rec idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1207
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition O_monad_mult_natural {A B} (f : A -&gt; B)
    : O_functor f o O_monad_mult A == O_monad_mult B o O_functor (O_functor f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1210
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1211
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_indpaths; intros x; unfold O_monad_mult.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1212
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite (to_O_natural (O_functor f) x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1213
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite (O_rec_beta idmap x).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1214
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite (O_rec_beta idmap (O_functor f x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1215
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1216
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1217
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition O_monad_unitlaw1 (A : Type)
    : O_monad_mult A o (to O (O A)) == idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1220
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1221
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_indpaths; intros x; unfold O_monad_mult.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1222
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (O_rec_beta idmap (to O A x)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1223
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1224
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition O_monad_unitlaw2 (A : Type)
    : O_monad_mult A o (O_functor (to O A)) == idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1227
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1228
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_indpaths; intros x; unfold O_monad_mult, O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1229
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      repeat rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1230
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1231
Time: 0.014s">
<div class="time" style="width: 18.421052631579%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1232
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition O_monad_mult_assoc (A : Type)
    : O_monad_mult A o O_monad_mult (O A) == O_monad_mult A o O_functor (O_monad_mult A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1235
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1236
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply O_indpaths; intros x; unfold O_monad_mult, O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1237
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      repeat rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1238
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1239
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1240
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End Monad.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1242
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Section StrongMonad.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1244
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Context {fs : Funext}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1245
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition O_monad_strength (A B : Type) : A * O B -&gt; O (A * B)
      := fun aob =&gt; O_rec (fun b a =&gt; to O (A*B) (a,b)) (snd aob) (fst aob).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1248
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

    Definition O_monad_strength_natural (A A' B B' : Type) (f : A -&gt; A') (g : B -&gt; B')
    : O_functor (functor_prod f g) o O_monad_strength A B ==
      O_monad_strength A' B' o functor_prod f (O_functor g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1252
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1253
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [a b].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> revert a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1254
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply ap10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1254
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      strip_reflections.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1255
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1256
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_monad_strength, O_functor; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1257
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      repeat rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1258
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1259
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1260
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    (** The diagrams for strength, see http://en.wikipedia.org/wiki/Strong_monad *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1263
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_monad_strength_unitlaw1 (A : Type)
    : O_functor (@snd Unit A) o O_monad_strength Unit A == @snd Unit (O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1264
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1265
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [[] a].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1266
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> strip_reflections.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1266
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_monad_strength, O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1267
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1268
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      napply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1269
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1270
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition O_monad_strength_unitlaw2 (A B : Type)
    : O_monad_strength A B o functor_prod idmap (to O B) == to O (A*B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1273
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1274
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [a b].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1275
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_monad_strength, functor_prod.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1276
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      revert a; apply ap10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1277
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      napply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1278
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1279
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>

    Definition O_monad_strength_assoc1 (A B C : Type)
    : O_functor (equiv_prod_assoc A B C)^-1 o O_monad_strength (A*B) C ==
      O_monad_strength A (B*C) o functor_prod idmap (O_monad_strength B C) o (equiv_prod_assoc A B (O C))^-1.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1283
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1284
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [[a b] c].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1285
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      revert a; apply ap10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1286
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> revert b; apply ap10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1286
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
      strip_reflections.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1287
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_arrow; intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1288
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_monad_strength, O_functor, functor_prod.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1289
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1289
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      repeat rewrite O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1290
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1291
Time: 0.006s">
<div class="time" style="width: 7.8947368421053%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1292
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

    Definition O_monad_strength_assoc2 (A B : Type)
    : O_monad_mult (A*B) o O_functor (O_monad_strength A B) o O_monad_strength A (O B) ==
      O_monad_strength A B o functor_prod idmap (O_monad_mult B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1296
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1297
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [a b].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1298
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> revert a; apply ap10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1298
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
      strip_reflections.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1299
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_arrow; intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1300
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      unfold O_monad_strength, O_functor, O_monad_mult, functor_prod.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1301
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1301
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
      repeat (rewrite O_rec_beta; simpl).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1302
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1303
Time: 0.007s">
<div class="time" style="width: 9.2105263157895%"></div>
<pre>
    Qed.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1304
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End StrongMonad.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1306
Time: 0.044s">
<div class="time" style="width: 57.894736842105%"></div>
<pre>

End Reflective_Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1308
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** Now we make the [O_inverts] notation global. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1310
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Notation O_inverts O f := (IsEquiv (O_functor O f)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1310
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected types *)

(** Connectedness of a type, relative to a modality or reflective subuniverse, can be defined in two equivalent ways: quantifying over all maps into modal types, or by considering just the universal case, the modal reflection of the type itself.  The former requires only core Coq, but blows up the size (universe level) of [IsConnected], since it quantifies over types; moreover, it is not even quite correct since (at least with a polymorphic modality) it should really be quantified over all universes.  Thus, we use the latter, although in most examples it requires HITs to define the modal reflection.

Question: is there a definition of connectedness (say, for n-types) that neither blows up the universe level, nor requires HIT's? *)

(** We give annotations to reduce the number of universe parameters. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1318
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Class IsConnected (O : ReflectiveSubuniverse@{i}) (A : Type@{i})
  := isconnected_contr_O :: Contr@{i} (O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1319
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedTypes.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1321
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : ReflectiveSubuniverse).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1322
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1325
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance ishprop_isconnected `{Funext} A
  : IsHProp (IsConnected O A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1326
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1327
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold IsConnected; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1328
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1329
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything equivalent to a connected type is connected. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1332
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_equiv (A : Type) {B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnected O A -&gt; IsConnected O B.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1333
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1334
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    intros ?; exact (contr_equiv (O A) (O_functor O f)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1335
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1336
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition isconnected_equiv' (A : Type) {B : Type} (f : A &lt;~&gt; B)
  : IsConnected O A -&gt; IsConnected O B
    := isconnected_equiv A f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1340
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The O-connected types form a subuniverse. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition Conn : Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1343
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1344
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    rapply (Build_Subuniverse (IsConnected O)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1345
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simpl; intros T U isconnT f isequivf.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1346
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (isconnected_equiv T f isconnT).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1347
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1348
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connectedness of a type [A] can equivalently be characterized by the fact that any map to an [O]-type [C] is nullhomotopic.  Here is one direction of that equivalence. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1351
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_elim {A : Type} `{IsConnected O A} (C : Type) `{In O C} (f : A -&gt; C)
  : NullHomotopy f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1352
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1353
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (ff := @O_rec O _ _ _ _ _ f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1354
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (ff (center _)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1355
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1356
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1356
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (ap ff (contr (to O _ a)) @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1357
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply O_rec_beta.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1358
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1359
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** For the other direction of the equivalence, it's sufficient to consider the case when [C] is [O A]. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1362
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_from_elim_to_O {A : Type}
  : NullHomotopy (to O A) -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1363
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1364
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros nh.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1365
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply (Build_Contr _ (nh .1)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1366
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    rapply O_indpaths.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1367
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros x; symmetry; apply (nh .2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1368
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1369
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Now the general case follows. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1372
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_from_elim {A : Type}
  : (forall (C : Type) `{In O C} (f : A -&gt; C), NullHomotopy f)
    -&gt; IsConnected O A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1374
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1375
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros H.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1376
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (isconnected_from_elim_to_O (H (O A) (O_inO A) (to O A))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1377
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1378
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connected types are closed under sigmas. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1381
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance isconnected_sigma {A : Type} {B : A -&gt; Type}
             `{IsConnected O A} `{forall a, IsConnected O (B a)}
  : IsConnected O {a:A &amp; B a}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1383
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1384
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isconnected_from_elim; intros C ? f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1385
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (nB := fun a =&gt; @isconnected_elim (B a) _ C _ (fun b =&gt; f (a;b))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1386
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pose (nA := isconnected_elim C (fun a =&gt; (nB a).1)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1387
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (nA.1); intros [a b].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1388
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact ((nB a).2 b @ nA.2 a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1389
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1390
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Contractible types are connected. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1393
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance isconnected_contr {A : Type} `{Contr A}
    : IsConnected O A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1394
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1395
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    rapply contr_O_contr.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1396
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1397
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A type which is both connected and modal is contractible. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1400
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition contr_trunc_conn {A : Type} `{In O A} `{IsConnected O A}
  : Contr A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1401
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1402
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    exact (contr_equiv _ (to O A)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1403
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1404
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any map between connected types is inverted by O. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1407
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance O_inverts_isconnected {A B : Type} (f : A -&gt; B)
             `{IsConnected O A} `{IsConnected O B}
    : O_inverts O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1409
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1410
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
    exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1411
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1412
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Here's another way of stating the universal property for mapping out of connected types into modal ones. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1415
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition extendable_const_isconnected_inO (n : nat)
             (A : Type) `{IsConnected O A}
             (C : Type) `{In O C}
  : ExtendableAlong n (const_tt A) (fun _ =&gt; C).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1418
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1419
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    generalize dependent C;
      simple_induction n n IHn; intros C ?;
      [ exact tt | split ].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1422
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1423
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1423
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exists (fun _ : Unit =&gt; (isconnected_elim C f).1); intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1424
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      symmetry; apply ((isconnected_elim C f).2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1425
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1426
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (extendable_postcompose' n _ _ _ _ (IHn (h tt = k tt) (inO_paths _ _ _ _))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1427
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros []; exact equiv_idmap.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1428
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1429
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition ooextendable_const_isconnected_inO
             (A : Type@{i}) `{IsConnected@{i} O A}
             (C : Type@{j}) `{In O C}
  : ooExtendableAlong (const_tt A) (fun _ =&gt; C)
    := fun n =&gt; extendable_const_isconnected_inO n A C.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1435
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition isequiv_const_isconnected_inO `{Funext}
             {A : Type} `{IsConnected O A} (C : Type) `{In O C}
  : IsEquiv (@const A C).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1439
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1440
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    exact (@isequiv_compose _ _ _ (fun c u =&gt; c) _ _
              (isequiv_ooextendable (fun _ =&gt; C) (const_tt A)
                                    (ooextendable_const_isconnected_inO A C))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1443
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1444
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition equiv_const_isconnected_inO `{Funext}
             {A : Type} `{IsConnected O A} (C : Type) `{In O C}
  : C &lt;~&gt; (A -&gt; C) := Build_Equiv _ _ const (isequiv_const_isconnected_inO C).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1448
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

End ConnectedTypes.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1450
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally truncated maps *)

</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ModalMaps.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1453
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : ReflectiveSubuniverse).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1454
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is modal *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1457
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance mapinO_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1458
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1459
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    intros b; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1460
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1461
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A slightly specialized result: if [Empty] is modal, then a map with decidable hprop fibers (such as [inl] or [inr]) is modal. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1464
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance mapinO_hfiber_decidable_hprop {A B : Type} (f : A -&gt; B)
         `{In O Empty}
         `{forall b, IsHProp (hfiber f b)}
         `{forall b, Decidable (hfiber f b)}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1468
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1469
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1470
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    destruct (equiv_decidable_hprop (hfiber f b)) as [e|e].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1471
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1472
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> exact (inO_equiv_inO Unit e^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1472
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1473
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> exact (inO_equiv_inO Empty e^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1473
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1474
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any map between modal types is modal. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1477
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance mapinO_between_inO {A B : Type} (f : A -&gt; B)
             `{In O A} `{In O B}
  : MapIn O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1479
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1480
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    intros b; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1481
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1482
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Modal maps cancel on the left. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1485
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition cancelL_mapinO {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
  : MapIn O g -&gt; MapIn O (g o f) -&gt; MapIn O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1486
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1487
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros ? ? b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1488
Time: 0.024s">
<div class="time" style="width: 31.578947368421%"></div>
<pre>
    exact (inO_equiv_inO _ (hfiber_hfiber_compose_map f g b)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1489
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1490
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Modal maps also cancel with equivalences on the other side. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1493
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition cancelR_isequiv_mapinO {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
    `{IsEquiv _ _ f} `{MapIn O _ _ (g o f)}
  : MapIn O g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1495
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1496
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1497
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    srefine (inO_equiv_inO' (hfiber (g o f) b) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1498
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (equiv_functor_sigma f (fun a =&gt; 1%equiv)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1499
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1500
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition cancelR_equiv_mapinO {A B C : Type} (f : A &lt;~&gt; B) (g : B -&gt; C)
    `{MapIn O _ _ (g o f)}
  : MapIn O g
  := cancelR_isequiv_mapinO f g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1505
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The pullback of a modal map is modal. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1508
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance mapinO_pullback {A B C}
         (f : B -&gt; A) (g : C -&gt; A) `{MapIn O _ _ g}
  : MapIn O (f^* g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1510
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1511
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1512
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (inO_equiv_inO _ (hfiber_pullback_along f g b)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1513
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1514
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  #[export] Instance mapinO_pullback' {A B C}
         (g : C -&gt; A) (f : B -&gt; A) `{MapIn O _ _ f}
  : MapIn O (g^*' f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1518
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1519
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1520
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre>
    exact (inO_equiv_inO _ (hfiber_pullback_along' g f c)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1521
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1522
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** [functor_sum] preserves modal maps. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1525
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance mapinO_functor_sum {A A' B B'}
         (f : A -&gt; A') (g : B -&gt; B') `{MapIn O _ _ f} `{MapIn O _ _ g}
  : MapIn O (functor_sum f g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1527
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1528
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a|b].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1529
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1530
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre> exact (inO_equiv_inO _ (hfiber_functor_sum_l f g a)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1530
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1531
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre> exact (inO_equiv_inO _ (hfiber_functor_sum_r f g b)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1531
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1532
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** So does [unfunctor_sum], if both summands are preserved.  These can't be [Instance]s since they require [Ha] and [Hb] to be supplied. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1535
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Definition mapinO_unfunctor_sum_l {A A' B B'}
         (h : A + B -&gt; A' + B')
         (Ha : forall a:A, is_inl (h (inl a)))
         (Hb : forall b:B, is_inr (h (inr b)))
         `{MapIn O _ _ h}
  : MapIn O (unfunctor_sum_l h Ha).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1540
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1541
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1542
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (inO_equiv_inO _ (hfiber_unfunctor_sum_l h Ha Hb a)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1543
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1544
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition mapinO_unfunctor_sum_r {A A' B B'}
         (h : A + B -&gt; A' + B')
         (Ha : forall a:A, is_inl (h (inl a)))
         (Hb : forall b:B, is_inr (h (inr b)))
         `{MapIn O _ _ h}
  : MapIn O (unfunctor_sum_r h Hb).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1551
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1552
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1553
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (inO_equiv_inO _ (hfiber_unfunctor_sum_r h Ha Hb b)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1554
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1555
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Given a family of maps [f : forall a, P a -&gt; Q a] which are in [O], the induced map on Pi types is also in [O]. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1558
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition mapinO_functor_forall_id `{Funext}
    {A : Type} {P Q : A -&gt; Type} (f : forall a, P a -&gt; Q a) `{forall a, MapIn O (f a)}
    : MapIn O (functor_forall_id f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1560
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1561
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intro g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1562
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    exact (inO_equiv_inO _ (hfiber_functor_forall_id f g)^-1%equiv).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1563
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1564
Time: 0.01s">
<div class="time" style="width: 13.157894736842%"></div>
<pre>

End ModalMaps.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1566
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Modally connected maps *)

(** Connectedness of a map can again be defined in two equivalent ways: by connectedness of its fibers (as types), or by the lifting property/elimination principle against modal types.  We use the former; the equivalence with the latter is given below in [conn_map_elim], [conn_map_comp], and [conn_map_from_extension_elim]. *)

</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1571
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Class IsConnMap (O : ReflectiveSubuniverse@{i})
      {A : Type@{i}} {B : Type@{i}} (f : A -&gt; B)
  := isconnected_hfiber_conn_map
     (** The extra universe [k] is &gt;= max(i,j). *)
     :: forall b:B, IsConnected@{i} O (hfiber@{i i} f b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1575
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Section ConnectedMaps.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1577
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Universe i.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1578
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Context (O : ReflectiveSubuniverse@{i}).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1579
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Any equivalence is connected *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1582
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance conn_map_isequiv {A B : Type} (f : A -&gt; B) `{IsEquiv _ _ f}
  : IsConnMap O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1583
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1584
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    intros b; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1585
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1586
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Anything homotopic to a connected map is connected. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1589
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition conn_map_homotopic {A B : Type} (f g : A -&gt; B) (h : f == g)
  : IsConnMap O f -&gt; IsConnMap O g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1590
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1591
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros ? b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1592
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    exact (isconnected_equiv O (hfiber@{i i} f b)
                             (equiv_hfiber_homotopic@{i i i} f g h b) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1594
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1595
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The pullback of a connected map is connected *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1598
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance conn_map_pullback {A B C}
         (f : B -&gt; A) (g : C -&gt; A) `{IsConnMap O _ _ g}
  : IsConnMap O (f^* g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1600
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1601
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1602
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (isconnected_equiv _ _ (hfiber_pullback_along f g b)^-1 _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1603
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1604
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  #[export] Instance conn_map_pullback' {A B C}
         (g : C -&gt; A) (f : B -&gt; A) `{IsConnMap O _ _ f}
  : IsConnMap O (g^*' f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1608
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1609
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros c.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1610
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    exact (isconnected_equiv _ _ (hfiber_pullback_along' g f c)^-1 _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1611
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1612
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The projection from a family of connected types is connected. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1615
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance conn_map_pr1 {A : Type} {B : A -&gt; Type}
         `{forall a, IsConnected O (B a)}
  : IsConnMap O (@pr1 A B).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1617
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1618
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1619
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (isconnected_equiv O (B a) (hfiber_fibration a B) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1620
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1621
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Being connected is an hprop *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1624
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance ishprop_isconnmap `{Funext} {A B : Type} (f : A -&gt; B)
  : IsHProp (IsConnMap O f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1625
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1626
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    exact istrunc_forall.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1627
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1628
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** A map which is both connected and modal is an equivalence. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1631
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isequiv_conn_ino_map {A B : Type} (f : A -&gt; B)
             `{IsConnMap O _ _ f} `{MapIn O _ _ f}
  : IsEquiv f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1633
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1634
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_contr_map.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1635
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1635
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (contr_trunc_conn O).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1636
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1637
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connected maps are orthogonal to modal maps (i.e. families of modal types). *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1640
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition conn_map_elim
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
             (d : forall a:A, P (f a))
  : forall b:B, P b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1644
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1645
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1646
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (pr1 (isconnected_elim O (A:=hfiber f b) _ _)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1647
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1648
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (transport P p (d a)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1649
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1650
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition conn_map_comp
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
             (d : forall a:A, P (f a))
  : forall a:A, conn_map_elim f P d (f a) = d a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1656
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1657
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1658
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> unfold conn_map_elim.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1658
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    set (fibermap := (fun a0p : hfiber f (f a)
                      =&gt; let (a0, p) := a0p in transport P p (d a0))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1660
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    destruct (isconnected_elim O (P (f a)) fibermap) as [x e].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1661
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    change (d a) with (fibermap (a;1)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1662
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply inverse, e.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1663
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1664
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** We can re-express this in terms of extensions. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1667
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Lemma extension_conn_map_elim
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
  : ExtensionAlong f P d.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1671
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1672
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1673
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_comp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1674
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1675
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition extendable_conn_map_inO (n : nat)
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : ExtendableAlong n f P.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1680
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1681
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    generalize dependent P.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1682
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    simple_induction n n IHn; intros P ?; [ exact tt | split ].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1683
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1684
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros d; apply extension_conn_map_elim; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1684
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1685
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h k; apply IHn; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1685
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1686
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Definition ooextendable_conn_map_inO
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : ooExtendableAlong f P
    := fun n =&gt; extendable_conn_map_inO n f P.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1692
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  Lemma allpath_extension_conn_map `{Funext}
        {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
        (P : B -&gt; Type) `{forall b:B, In O (P b)}
        (d : forall a:A, P (f a))
        (e e' : ExtensionAlong f P d)
  : e = e'.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1699
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1700
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_extension.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1701
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (extension_conn_map_elim _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1702
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1703
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** It follows that [conn_map_elim] is actually an equivalence. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1706
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Theorem isequiv_o_conn_map `{Funext}
          {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
          (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : IsEquiv (fun (g : forall b:B, P b) =&gt; g oD f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1709
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1710
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply isequiv_contr_map; intros d.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1711
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply contr_inhabited_hprop.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1712
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1713
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> nrefine (@istrunc_equiv_istrunc {g : forall b, P b &amp; g oD f == d} _ _ _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1713
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1714
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> refine (equiv_functor_sigma_id _); intros g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1714
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
        apply equiv_path_forall.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1715
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1715
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply hprop_allpath.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1716
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros g h.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1716
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (allpath_extension_conn_map f P d g h).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1717
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1718
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exists (conn_map_elim f P d).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1718
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply path_forall; intros x; apply conn_map_comp.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1719
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1720
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition equiv_o_conn_map `{Funext}
          {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
          (P : B -&gt; Type) `{forall b:B, In O (P b)}
  : (forall b, P b) &lt;~&gt; (forall a, P (f a))
  := Build_Equiv _ _ _ (isequiv_o_conn_map f P).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1726
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** When considering lexness properties, we often want to consider the property of the universe of modal types being modal.  We can't say this directly (except in the accessible, hence liftable, case) because it lives in a higher universe, but we can make a direct extendability statement.  Here we prove a lemma that oo-extendability into the universe follows from plain extendability, essentially because the type of equivalences between two [O]-modal types is [O]-modal. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1729
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition ooextendable_TypeO_from_extension `{Univalence}
             {A B : Type} (f : A -&gt; B) `{IsConnMap O _ _ f}
             (extP : forall P : A -&gt; Type_ O, ExtensionAlong f (fun _ : B =&gt; Type_ O) P)
    : ooExtendableAlong f (fun _ =&gt; Type_ O).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1732
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1733
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    (** By definition, in addition to our assumption [extP] that maps into [Type_ O] extend along [f], we must show that sections of families of equivalences are [ooExtendableAlong] it.  *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1735
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>intros [|[|n]].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1735
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact tt.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1736
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>                                 (* n = 0 *)
    (** Note that due to the implementation of [ooExtendableAlong], we actually have to use [extP] twice (there should probably be a general cofixpoint lemma for this). *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>-</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> split; [ apply extP | intros; exact tt ].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1738
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> (* n = 1 *)
   </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>-</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> split; [ apply extP | ].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1739
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>                  (* n &gt; 1 *)
      (** What remains is to extend families of paths. *)
     </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1741
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>intros P Q; rapply (ooextendable_postcompose' (fun b =&gt; P b &lt;~&gt; Q b)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1741
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1742
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x; exact (equiv_path_TypeO _ _ _ oE equiv_path_universe _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1742
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      +</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1743
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre> rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1743
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1744
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Conversely, if a map satisfies this elimination principle (expressed via extensions), then it is connected.  This completes the proof of Lemma 7.5.7 from the book. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1747
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Lemma conn_map_from_extension_elim {A B : Type} (f : A -&gt; B)
  : (forall (P : B -&gt; Type) {P_inO : forall b:B, In O (P b)}
            (d : forall a:A, P (f a)),
       ExtensionAlong f P d)
    -&gt; IsConnMap O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1751
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1752
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros Hf b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1753
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply isconnected_from_elim_to_O.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1753
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    assert (e := Hf (fun b =&gt; O (hfiber f b)) _ (fun a =&gt; to O _ (a;1))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1754
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (e.1 b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1755
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros [a p].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1756
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> destruct p.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1756
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    symmetry; apply (e.2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1757
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1758
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.6: Connected maps compose and cancel on the right. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1761
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance conn_map_compose {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ g}
  : IsConnMap O (g o f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1763
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1764
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1765
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (conn_map_elim g P (conn_map_elim f (fun b =&gt; P (g b)) d)); intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1766
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (conn_map_comp g P _ _ @ conn_map_comp f (fun b =&gt; P (g b)) d a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1767
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1768
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>      

  Definition cancelR_conn_map {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsConnMap O _ _ f} `{IsConnMap O _ _ (g o f)}
  :  IsConnMap O g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1772
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1773
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros P ? d.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1774
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exists (conn_map_elim (g o f) P (d oD f)); intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1775
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    pattern b; refine (conn_map_elim f _ _ b); intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1776
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (conn_map_comp (g o f) P (d oD f) a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1777
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1778
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connected maps also cancel with equivalences on the other side. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1781
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition cancelL_isequiv_conn_map {A B C : Type} (f : A -&gt; B) (g : B -&gt; C)
         `{IsEquiv _ _ g} `{IsConnMap O _ _ (g o f)}
    : IsConnMap O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1783
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1784
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1785
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    srefine (isconnected_equiv' O (hfiber (g o f) (g b)) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1786
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (equiv_inverse (equiv_functor_sigma_id (fun a =&gt; equiv_ap g (f a) b))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1787
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1788
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>

  Definition cancelL_equiv_conn_map {A B C : Type} (f : A -&gt; B) (g : B &lt;~&gt; C)
         `{IsConnMap O _ _ (g o f)}
    : IsConnMap O f
    := cancelL_isequiv_conn_map f g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1793
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** The constant map to [Unit] is connected just when its domain is. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1796
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_conn_map_to_unit {A : Type}
             `{IsConnMap O _ _ (const_tt A)}
  : IsConnected O A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1798
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1799
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    exact (isconnected_equiv O (hfiber (const_tt A) tt)
              (equiv_sigma_contr _) _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1801
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1802
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  #[local]
  Hint Immediate isconnected_conn_map_to_unit : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1805
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  #[export] Instance conn_map_to_unit_isconnected {A : Type}
         `{IsConnected O A}
  : IsConnMap O (const_tt A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1809
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1810
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros u.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1811
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    exact (isconnected_equiv O A
              (equiv_sigma_contr _)^-1 _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1813
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1814
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

 (** Combining the above, we see that if [f] is a connected map with connected codomain, then the domain is connected. *)

</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1817
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Instance isconnected_conn_map_isconnected {A B : Type} (f : A -&gt; B)
         `{IsConnMap O _ _ f} `{IsConnected O B}
   : IsConnected O A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1819
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
 Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1820
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
   rapply isconnected_conn_map_to_unit.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1821
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
   rapply conn_map_compose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1822
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
 Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1823
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (* Lemma 7.5.10: A map to a type in [O] exhibits its codomain as the [O]-reflection of its domain if it is [O]-connected.  (The converse is true if and only if [O] is a modality.) *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1826
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isequiv_O_rec_conn_map {A B : Type} `{In O B}
             (f : A -&gt; B) `{IsConnMap O _ _ f}
  : IsEquiv (O_rec (O := O) f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1828
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1829
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    refine (isequiv_adjointify _ (conn_map_elim f (fun _ =&gt; O A) (to O A)) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1830
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1831
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1831
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> pattern x.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1831
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (conn_map_elim f _ _ x); intros a.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1832
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (ap (O_rec f)
                (conn_map_comp f (fun _ =&gt; O A) (to O A) a)
                @ O_rec_beta f a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1835
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1836
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply O_indpaths; intros a; simpl.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1836
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      refine (ap _ (O_rec_beta f a) @ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1837
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (conn_map_comp f (fun _ =&gt; O A) (to O A) a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1838
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1839
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.12 *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1842
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Section ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1842
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Context {A B : Type} {P : A -&gt; Type} {Q : B -&gt; Type}
            (f : A -&gt; B) (g : forall a, P a -&gt; Q (f a))
            `{forall a, IsConnMap O (g a)}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1846
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition equiv_O_hfiber_functor_sigma (b:B) (v:Q b)
    : O (hfiber (functor_sigma f g) (b;v)) &lt;~&gt; O (hfiber f b).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1849
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1850
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; hfiber (g w.1) ((w.2)^ # v)}).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1851
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1852
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> apply equiv_O_functor, hfiber_functor_sigma.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1852
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1852
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      equiv_via (O {w : hfiber f b &amp; O (hfiber (g w.1) ((w.2)^ # v))}).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1853
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      {</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1854
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> symmetry; apply equiv_O_sigma_O.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1854
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> }</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1854
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      apply equiv_O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1855
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
      apply equiv_sigma_contr; intros [a p]; simpl; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1856
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1857
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    #[export] Instance conn_map_functor_sigma `{IsConnMap O _ _ f}
    : IsConnMap O (functor_sigma f g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1860
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1861
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros [b v].</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1862
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      exact (contr_equiv' _ (equiv_inverse (equiv_O_hfiber_functor_sigma b v))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1863
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1864
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

    Definition conn_map_base_inhabited (inh : forall b, Q b)
               `{IsConnMap O _ _ (functor_sigma f g)}
    : IsConnMap O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1868
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1869
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
      intros b.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1870
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
      exact (contr_equiv _ (equiv_O_hfiber_functor_sigma b (inh b))).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1871
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1872
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  End ConnMapFunctorSigma.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1874
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.13.  The "if" direction is a special case of [conn_map_functor_sigma], so we prove only the "only if" direction. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1877
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition conn_map_fiber
             {A : Type} {P Q : A -&gt; Type} (f : forall a, P a -&gt; Q a)
             `{IsConnMap O _ _ (functor_sigma idmap f)}
  : forall a, IsConnMap O (f a).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1880
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1881
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    intros a q.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1882
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    refine (isconnected_equiv' O (hfiber (functor_sigma idmap f) (a;q)) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1883
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (hfiber_functor_sigma_idmap P Q f a q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1884
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1885
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Lemma 7.5.14: Connected maps are inverted by [O]. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1888
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance O_inverts_conn_map {A B : Type} (f : A -&gt; B)
         `{IsConnMap O _ _ f}
    : O_inverts O f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1890
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1891
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    rapply O_inverts_from_extendable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1892
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    intros; rapply extendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1893
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1894
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** As a consequence, connected maps between modal types are equivalences. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1897
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>Definition isequiv_conn_map_ino {A B : Type} (f : A -&gt; B)
         `{In O A} `{In O B} `{IsConnMap O _ _ f}
    : IsEquiv f
    := isequiv_commsq' f (O_functor O f) (to O A) (to O B) (to_O_natural O f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1900
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connectedness is preserved by [O_functor]. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1903
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>#[export] Instance conn_map_O_functor {A B} (f : A -&gt; B) `{IsConnMap O _ _ f}
    : IsConnMap O (O_functor O f).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1904
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1905
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    unfold O_functor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1906
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
    rapply conn_map_compose.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1907
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1908
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connected maps are preserved by coproducts *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1911
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition conn_map_sum {A B A' B'} (f : A -&gt; A') (g : B -&gt; B')
             `{IsConnMap O _ _ f} `{IsConnMap O _ _ g}
    : IsConnMap O (functor_sum f g).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1913
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1914
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1915
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
    apply extension_functor_sum; rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1916
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1917
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** Connected maps are preserved by coequalizers *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1920
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition conn_map_functor_coeq {B A B' A'}
             {f g : B -&gt; A} {f' g' : B' -&gt; A'}
             (h : B -&gt; B') (k : A -&gt; A')
             (p : k o f == f' o h) (q : k o g == g' o h)
             `{IsConnMap O _ _ k} `{IsConnMap O _ _ h}
    : IsConnMap O (functor_coeq h k p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1925
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1926
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1927
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply extension_functor_coeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1928
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1929
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1929
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1930
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> intros; rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1930
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1931
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

  (** And by pushouts *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1934
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition conn_map_functor_pushout {A B C A' B' C'}
             (f : A -&gt; B) (g : A -&gt; C) {f' : A' -&gt; B'} {g' : A' -&gt; C'}
             (h : A -&gt; A') (k : B -&gt; B') (l : C -&gt; C')
             (p : k o f == f' o h) (q : l o g == g' o h)
             `{IsConnMap O _ _ h} `{IsConnMap O _ _ k} `{IsConnMap O _ _ l}
    : IsConnMap O (functor_pushout h k l p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1939
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1940
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply conn_map_from_extension_elim; intros.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1941
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
    apply extension_functor_coeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1942
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1943
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre> apply extendable_functor_sum; rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1943
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1944
Time: 0.009s">
<div class="time" style="width: 11.842105263158%"></div>
<pre> intros; rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1944
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
  Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1945
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre>

End ConnectedMaps.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1947
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** ** Containment of (reflective) subuniverses *)

(** One subuniverse is contained in another if every [O1]-modal type is [O2]-modal.  We define this parametrized by three universes: [O1] and [O2] are reflective subuniverses of [Type@{i1}] and [Type@{i2}] respectively, and the relation says that all types in [Type@{j}] that [O1]-modal are also [O2]-modal.  This implies [j &lt;= i1] and [j &lt;= i2], of course.  The most common application is when [i1 = i2 = j], but it's sometimes useful to talk about a subuniverse of a larger universe agreeing with a subuniverse of a smaller universe on the smaller universe.  *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1951
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Class O_leq@{i1 i2 j} (O1 : Subuniverse@{i1}) (O2 : Subuniverse@{i2})
  := inO_leq : forall (A : Type@{j}), In O1 A -&gt; In O2 A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1952
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Arguments inO_leq O1 O2 {_} A _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1954
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Declare Scope subuniverse_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1956
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Notation "O1 &lt;= O2" := (O_leq O1 O2) : subuniverse_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1957
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Open Scope subuniverse_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1958
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Instance reflexive_O_leq : Reflexive O_leq | 10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1960
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1961
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros O A ?; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1962
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1963
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Instance transitive_O_leq : Transitive O_leq | 10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1965
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1966
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros O1 O2 O3 O12 O23 A ?.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1967
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  rapply (@inO_leq O2 O3).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1968
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  rapply (@inO_leq O1 O2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1969
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1970
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition mapinO_O_leq (O1 O2 : Subuniverse) `{O1 &lt;= O2}
           {A B : Type} (f : A -&gt; B) `{MapIn O1 A B f}
  : MapIn O2 f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1974
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1975
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros b; rapply (inO_leq O1 O2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1976
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1977
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This implies that every [O2]-connected type is [O1]-connected, and similarly for maps and equivalences.  We give universe annotations so that [O1] and [O2] don't have to be on the same universe, but we do have to have [i1 &lt;= i2] for this statement.  When [i2 &lt;= i1] it seems that the statement might not be true unless the RSU on the larger universe is accessibly extended from the smaller one; see [Localization.v].  *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1979
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition isconnected_O_leq@{i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{O_leq@{i1 i2 i1} O1 O2}
           (A : Type@{i1}) `{IsConnected O2 A}
  : IsConnected O1 A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1982
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1983
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply isconnected_from_elim.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1984
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros C C1 f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1985
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (isconnected_elim O2); srapply inO_leq; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1986
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1987
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This one has the same universe constraint [i1 &lt;= i2]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1989
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition conn_map_O_leq@{i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{O_leq@{i1 i2 i1} O1 O2}
           {A B : Type@{i1}} (f : A -&gt; B) `{IsConnMap O2 A B f}
  : IsConnMap O1 f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1992
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1993
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  (** We could prove this by applying [isconnected_O_leq] fiberwise, but unless we were very careful that would collapse the two universes [i1] and [i2].  So instead we just give an analogous direct proof. *)
 </pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1995
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>apply conn_map_from_extension_elim.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1995
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros P P_inO g.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1996
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  rapply (extension_conn_map_elim O2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1997
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros b; rapply (inO_leq O1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1998
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 1999
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** This is Lemma 2.12(i) in CORS, again with the same universe constraint [i1 &lt;= i2]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2001
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition O_inverts_O_leq@{i1 i2}
           (O1 : ReflectiveSubuniverse@{i1}) (O2 : ReflectiveSubuniverse@{i2}) `{O_leq@{i1 i2 i1} O1 O2}
           {A B : Type@{i1}} (f : A -&gt; B) `{O_inverts O2 f}
  : O_inverts O1 f.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2004
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2005
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply O_inverts_from_extendable@{i1 i1 i1 i1 i1}; intros Z Z_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2006
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  pose (inO_leq O1 O2 Z _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2007
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply (lift_extendablealong@{i1 i1 i1 i1 i1 i1 i2 i1 i1 i2 i1}).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2008
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  apply (ooextendable_O_inverts O2); exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2009
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2010
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Equality of (reflective) subuniverses *)

(** Two subuniverses are the same if they have the same modal types.  The universe parameters are the same as for [O_leq]: [O1] and [O2] are reflective subuniverses of [Type@{i1}] and [Type@{i2}], and the relation says that they agree when restricted to [Type@{j}], where [j &lt;= i1] and [j &lt;= i2]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2015
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>Class O_eq@{i1 i2 j} (O1 : Subuniverse@{i1}) (O2 : Subuniverse@{i2}) :=
{
  O_eq_l :: O_leq@{i1 i2 j} O1 O2 ;
  O_eq_r :: O_leq@{i2 i1 j} O2 O1 ;
}.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2019
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Infix "&lt;=&gt;" := O_eq : subuniverse_scope.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2021
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>

Definition issig_O_eq O1 O2 : _ &lt;~&gt; O_eq O1 O2 := ltac:(issig).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2023
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Instance reflexive_O_eq : Reflexive O_eq | 10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2025
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2026
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros; split; reflexivity.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2027
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2028
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Instance transitive_O_eq : Transitive O_eq | 10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2030
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2031
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  intros O1 O2 O3; split; exact (transitivity (y := O2) _ _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2032
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2033
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Instance symmetric_O_eq : Symmetric O_eq | 10.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2035
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2036
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros O1 O2 [? ?]; split; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2037
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2038
Time: 0.006s">
<div class="time" style="width: 7.8947368421053%"></div>
<pre>

Definition issig_subuniverse : _ &lt;~&gt; Subuniverse := ltac:(issig).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2040
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition equiv_path_subuniverse `{Univalence} (O1 O2 : Subuniverse)
  : (O1 &lt;=&gt; O2) &lt;~&gt; (O1 = O2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2043
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2044
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (_ oE (issig_O_eq O1 O2)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2045
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  revert O1 O2; refine (equiv_path_along_equiv issig_subuniverse _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2046
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  cbn; intros O1 O2.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2047
Time: 0.01s">
<div class="time" style="width: 13.157894736842%"></div>
<pre>
  refine (equiv_path_sigma_hprop O1 O2 oE _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2048
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>
  destruct O1 as [O1 [O1h ?]]; destruct O2 as [O2 [O2h ?]]; cbn.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2049
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  refine (equiv_path_arrow _ _ oE _).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2050
Time: 0.012s">
<div class="time" style="width: 15.789473684211%"></div>
<pre>
  srapply (equiv_iff_hprop).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2051
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2052
Time: 0.009s">
<div class="time" style="width: 11.842105263158%"></div>
<pre> srapply istrunc_sigma; unfold O_leq; exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2052
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2053
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros [h k] A; specialize (h A); specialize (k A); cbn in *.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2053
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    apply path_universe_uncurried, equiv_iff_hprop; assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2054
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2055
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros h; split; intros A e; specialize (h A); cbn in *.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2055
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    1:rewrite &lt;- h.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2056
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    2:rewrite h.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2057
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    all:exact e.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2058
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2059
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** It should also be true that if [O1] and [O2] are reflective subuniverses, then [O1 &lt;=&gt; O2] is equivalent to [O1 = O2 :&gt; ReflectiveSubuniverse].  Probably [contr_typeof_O_unit] should be useful in proving that. *)

(** Reflections into one subuniverse are also reflections into an equal one.  Unfortunately these almost certainly can't be [Instance]s for fear of infinite loops, since [&lt;=&gt;] is reflexive. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2063
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition prereflects_O_leq
           (O1 O2 : Subuniverse) `{O1 &lt;= O2}
           (A : Type) `{PreReflects O1 A}
  : PreReflects O2 A.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2066
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2067
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unshelve econstructor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2068
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2069
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (O_reflector O1 A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2069
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2070
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> rapply (inO_leq O1 O2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2070
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2071
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> exact (to O1 A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2071
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2072
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Definition reflects_O_eq
           (O1 O2 : Subuniverse) `{O1 &lt;=&gt; O2}
           (A : Type) `{Reflects O1 A}
  : @Reflects O2 A (prereflects_O_leq O1 O2 A).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2077
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2078
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  constructor; intros B B_inO2.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2079
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  pose proof (inO_leq O2 O1 _ B_inO2).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2080
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  exact (extendable_to_O O1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2081
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2082
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>


(** ** Separated subuniverses *)

(** For any subuniverse [O], a type is [O]-separated iff all its identity types are [O]-modal.  We will study these further in [Separated.v], but we put the definition here because it's needed in [Descent.v]. *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2087
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>Definition Sep (O : Subuniverse) : Subuniverse.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2087
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2088
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  unshelve econstructor.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2089
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2090
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros A; exact (forall (x y:A), In O (x = y)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2090
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2091
Time: 0.004s">
<div class="time" style="width: 5.2631578947368%"></div>
<pre> exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2091
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2092
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> intros T U ? f ? x y; cbn in *.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2092
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
    exact (inO_equiv_inO' _ (equiv_ap f^-1 x y)^-1).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2093
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2094
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Instance inO_paths_SepO (O : Subuniverse)
       {A : Type} {A_inO : In (Sep O) A} (x y : A)
  : In O (x = y)
  := A_inO x y.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2099
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** TODO: Where to put this?  Morally it goes with the study of [&lt;&lt;] in [Modality.v] and [&lt;&lt;&lt;] in [Descent.v] and [Sep] in [Separated.v], but it doesn't actually need any of those relations, only [O' &lt;= Sep O], and it would also be nice to have it next to  [O_inverts_functor_coeq].  It's a variation on the latter: if [O' &lt;= Sep O], then for [O'] to invert [functor_coeq h k] it suffices that it invert [k] and that [h] be [O]-connected (by [conn_map_OO_inverts], which has different hypotheses but applies in many of the same examples, that is a weaker assumption). *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2101
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition OO_inverts_functor_coeq
           (O O' : ReflectiveSubuniverse) `{O' &lt;= Sep O}
           {B A : Type} (f g : B -&gt; A)
           {B' A' : Type} (f' g' : B' -&gt; A')
           (h : B -&gt; B') (k : A -&gt; A')
           (p : k o f == f' o h) (q : k o g == g' o h)
           `{O_inverts O' k} `{IsConnMap O _ _ h}
  : O_inverts O' (functor_coeq h k p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2108
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2109
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply O_inverts_from_extendable.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2110
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  intros Z Z_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2111
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply extendable_functor_coeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2112
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2113
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre> napply (ooextendable_O_inverts O'); assumption.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2113
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2114
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre> pose (inO_leq O' (Sep O)).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2114
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
    intros u v; rapply (extendable_conn_map_inO O).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2115
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2116
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** And a similar property for pushouts *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2118
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre>Definition OO_inverts_functor_pushout
           (O O' : ReflectiveSubuniverse) `{O' &lt;= Sep O}
           {A B C A' B' C'}
           (f : A -&gt; B) (g : A -&gt; C) {f' : A' -&gt; B'} {g' : A' -&gt; C'}
           (h : A -&gt; A') (k : B -&gt; B') (l : C -&gt; C')
           (p : k o f == f' o h) (q : l o g == g' o h)
           `{IsConnMap O _ _ h} `{O_inverts O' k} `{O_inverts O' l}
  : O_inverts O' (functor_pushout h k l p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2125
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2126
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
  napply (OO_inverts_functor_coeq O O').</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2127
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  1,3:exact _.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2128
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  rapply O_inverts_functor_sum.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2129
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2130
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

(** And similar properties for connected maps *)</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2132
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>Definition OO_conn_map_functor_coeq
           (O O' : ReflectiveSubuniverse) `{O' &lt;= Sep O}
           {B A B' A'}
           {f g : B -&gt; A} {f' g' : B' -&gt; A'}
           (h : B -&gt; B') (k : A -&gt; A')
           (p : k o f == f' o h) (q : k o g == g' o h)
           `{IsConnMap O' _ _ k} `{IsConnMap O _ _ h}
  : IsConnMap O' (functor_coeq h k p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2139
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2140
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply conn_map_from_extension_elim; intros.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2141
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply extension_functor_coeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2142
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2143
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre> rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2143
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2144
Time: 0.007s">
<div class="time" style="width: 9.2105263157895%"></div>
<pre> pose (inO_leq O' (Sep O));
    intros; rapply (ooextendable_conn_map_inO O).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2145
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2146
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>

Definition OO_conn_map_functor_pushout
           (O O' : ReflectiveSubuniverse) `{O' &lt;= Sep O}
           {A B C A' B' C'}
           (f : A -&gt; B) (g : A -&gt; C) {f' : A' -&gt; B'} {g' : A' -&gt; C'}
           (h : A -&gt; A') (k : B -&gt; B') (l : C -&gt; C')
           (p : k o f == f' o h) (q : l o g == g' o h)
           `{IsConnMap O _ _ h} `{IsConnMap O' _ _ k} `{IsConnMap O' _ _ l}
  : IsConnMap O' (functor_pushout h k l p q).</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2155
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Proof.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2156
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  apply conn_map_from_extension_elim; intros.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2157
Time: 0.001s">
<div class="time" style="width: 1.3157894736842%"></div>
<pre>
  apply extension_functor_coeq.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2158
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2159
Time: 0.005s">
<div class="time" style="width: 6.5789473684211%"></div>
<pre> apply extendable_functor_sum; rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2159
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
  -</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2160
Time: 0.003s">
<div class="time" style="width: 3.9473684210526%"></div>
<pre> pose (inO_leq O' (Sep O));
    intros; rapply ooextendable_conn_map_inO.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2161
Time: 0.002s">
<div class="time" style="width: 2.6315789473684%"></div>
<pre>
Defined.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2162
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

Hint Immediate inO_isequiv_to_O : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2164
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Hint Immediate inO_unsigma : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2165
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>
Hint Immediate isconnected_conn_map_to_unit : typeclass_instances.</pre>
</div>
<div class="code" title="File: ReflectiveSubuniverse.v
Line: 2167
Time: 0s">
<div class="time" style="width: 0%"></div>
<pre>

</pre>
</div>
</body>
</html>

