language: python
# python, for proviola

python:
 - "2.7"

# don't build the autogenerated master-with-autoreconf-files
branches:
 except:
   - master-with-autoreconf-files

env:

 matrix:
   - UPDATE_HTML=""       WITH_AUTORECONF="yes"  UPDATE_QUICK_DOC=""     UPDATE_AUTOGEN=""     UPDATE_DEP_GRAPHS="yes" BUILD_COQ="yes"  UPDATE_OPAM=""
   - UPDATE_HTML=""       WITH_AUTORECONF="yes"  UPDATE_QUICK_DOC="yes"  UPDATE_AUTOGEN="yes"  UPDATE_DEP_GRAPHS=""    BUILD_COQ="yes"  UPDATE_OPAM="yes"
   - UPDATE_HTML="yes"    WITH_AUTORECONF="yes"  UPDATE_QUICK_DOC=""     UPDATE_AUTOGEN=""     UPDATE_DEP_GRAPHS=""    BUILD_COQ="yes"  UPDATE_OPAM=""
   - UPDATE_HTML=""       WITH_AUTORECONF=""     UPDATE_QUICK_DOC=""     UPDATE_AUTOGEN=""     UPDATE_DEP_GRAPHS=""    BUILD_COQ="yes"  UPDATE_OPAM=""
   - UPDATE_HTML=""       WITH_AUTORECONF="yes"  UPDATE_QUICK_DOC=""     UPDATE_AUTOGEN=""     UPDATE_DEP_GRAPHS=""    BUILD_COQ=""     UPDATE_OPAM=""
   - UPDATE_HTML=""       WITH_AUTORECONF="yes"  UPDATE_QUICK_DOC=""     UPDATE_AUTOGEN=""     UPDATE_DEP_GRAPHS=""    BUILD_COQ="yes"  UPDATE_OPAM=""

 global:
# encrypted version of deploy key for pushing
    - secure: "ZY1D8tDl+rA5w99l1AL07iXEFUFJDk/PS/z5eGYjK+iAE8/+E7B9RgX042BYIWpqV+hkUL5qW1P5PDW9Q3hwjmCYHE5r9OMLFsrMj5W9Gldvh7iLPiePEOr3erXjute90m1+y0jIg2zgE+nvQu1KewZ6wBYi8TGvnoaqVi8xkRE="


matrix:
  fast_finish: true
  allow_failures:
    - env: UPDATE_HTML=""       WITH_AUTORECONF="yes"  UPDATE_QUICK_DOC=""     UPDATE_AUTOGEN=""     UPDATE_DEP_GRAPHS=""    BUILD_COQ=""     UPDATE_OPAM=""




before_script:
 - uname -a
 - ./etc/ci/before_script.sh
 - source ./etc/ci/travis_keep_alive.sh
 - export COMMITISH="$(git rev-list HEAD -1)"


# we must run make at the end, because the success of
# `make-pretty-timed` is not an indication that the build succeeded.
# We also use `make strict-test` at the beginning so that we error
# quickly if someone commited .v files but neglected to mention them.
script: "./autogen.sh && ./configure && if [ -z \"$UPDATE_QUICK_DOC\" ]; then make strict-test && ./etc/coq-scripts/timing/make-pretty-timed.sh V=1 -j2 && make && ./etc/coq-scripts/timing/cat-timing-files.sh && cat ./time-of-build-pretty.log && echo; fi && ./etc/ci/after_success.sh"


after_success:
 - kill $PID_KEEP_ALIVE
